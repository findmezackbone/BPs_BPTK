
\documentclass[a4paper,punct=banjiao,twoside]{ctexrep}
% oneside/twoside 单面/双面打印适配版本.
% openright/openany 控制新的章节是否应该在奇数页的右侧开始, 但并不好用,建议手动插入空白页.
% fontset 设置字体集,可以选择的值包括 windows、mac、ubuntu 等,可以解决字体报错.
% punct=: 设置中文文档中的标点样式,可选的值包括 quanjiao 全角式:所有标点占一个汉字宽度,相邻两个标点占 1.5 汉字宽度;banjiao 半角式:所有标点占半个汉字宽度;kaiming 开明式:句末点号16用占一个汉字宽度,标号和句内点号占半个汉字宽度;等.


\usepackage[a4paper,hmargin={2.54cm,2.54cm},vmargin={3.175cm,3.175cm}]{geometry}
\headheight = 15 pt
%参见https://tex.stackexchange.com/questions/132170/what-do-headheight-headsep-etc-do-in-the-vmargin-package最高赞答案

\usepackage{amsmath,amssymb}
% 扩展支持的数学符号

\usepackage{mathrsfs}
% 引用


\usepackage[dvipsnames, svgnames, x11names]{xcolor}
% 扩展颜色

\usepackage[colorlinks=true,linkcolor=Maroon]{hyperref}
% 使用hyperref宏包, 对目录, 公式引用, 文献引用做超链接, 超链接方便电子版的阅读, 但不影响打印.
% pdfborder对超链接的边框大小进行设置, 模板中默认边框大小为0.
% colorlinks=true, 表示超链接对应的文字采用超链接边框的颜色, =false时保持原字体颜色.
% linkcolor=maroon, 设置超链接边框的颜色, 可以改为red,green等等.

\usepackage{amsthm}
% 配置定理环境
\theoremstyle{plain}
%plain(默认样式): 定理名称是正体,定理内容是斜体.
%definition: 定理名称和定理内容都是正体,其上下留有额外的空间．
%remark: 正体,其上下没有额外的空间．
\newtheorem{thm}{定理}[chapter]
% 如果需要在每一节中单独编号,请将[chapter]改为[section]
\newtheorem{lemma}[thm]{引理}
\newtheorem{axiom}[thm]{公理}
\newtheorem{coro}[thm]{推论}
\newtheorem{prop}[thm]{命题}
\newtheorem{con}[thm]{猜想}

\theoremstyle{definition}
\newtheorem{defn}[thm]{定义}
\newtheorem{asm}[thm]{假设}
\newtheorem{que}[thm]{问题}

\theoremstyle{remark}
\newtheorem{rem}{注}[chapter]
\newtheorem{example}{例}[chapter]
% 除了注和例之外,均是连续编号.
\renewcommand{\proofname}{\textbf{证明}}
% 如需将证毕符号改成黑色的正方形,请将下一行取消注释.
% \renewcommand{\qedsymbol}{$\blacksquare$}    
\newcommand{\dd}{\text{d}}
\newcommand{\R}{{\mathbb R}}
\newcommand{\N}{{\mathbb N}}
%\newcommand{\Z}{{\mathbb Z}}
%\newcommand{\C}{{\mathbb C}}
% 此处可以定义一些常用的记号,留给大家自由发挥咯,例如输入\dd 可以直接得到正体的d,用作积分号里dx中的d.

%其余的一些必要的宏包
\usepackage{xcolor,caption,array,enumerate}
\usepackage{graphicx} %插入图片的宏包
\usepackage{float} %设置图片浮动位置的宏包
\usepackage{subcaption} %插入多图时用子图显示的宏包

\usepackage{tikz}%画图
\usepackage{longtable, booktabs, threeparttable, caption, bicaption, multirow}
% 扩展表格功能
\usepackage[ruled,linesnumbered]{algorithm2e}
% 算法
\usepackage{listings}
\lstset{
  language=Python, % 设置语言
  basicstyle=\ttfamily, % 设置字体族
  breaklines=true, % 自动换行
  keywordstyle=\bfseries\color{NavyBlue}, % 设置关键字为粗体,颜色为 NavyBlue
  morekeywords={}, % 设置更多的关键字,用逗号分隔
  emph={self}, % 指定强调词,如果有多个,用逗号隔开
  emphstyle=\bfseries\color{Rhodamine}, % 强调词样式设置
  commentstyle=\itshape\color{black!50!white}, % 设置注释样式,斜体,浅灰色
  stringstyle=\bfseries\color{PineGreen!90!black}, % 设置字符串样式
  columns=flexible,
  numbers=left, % 显示行号在左边
  numbersep=2em, % 设置行号的具体位置
  numberstyle=\footnotesize, % 缩小行号
  frame=single, % 边框
  framesep=1em % 设置代码与边框的距离
}
% 自定义多级标题格式
%\CTEXsetup[nameformat={\huge \heiti},titleformat={\huge \heiti},beforeskip={0.0cm},afterskip={1.2cm}]{chapter}
% 上一行为旧版的语法,可以选择注释上一行,取消注释下一行.
\ctexset { chapter = { nameformat={\huge \heiti  },titleformat={\huge \heiti  },beforeskip={0.0cm},afterskip={1.2cm} } } 
\usepackage{titlesec}
\titleformat{\section}[block]{\Large\centering\heiti}{\arabic{chapter}.\arabic{section}}{1em}{}[]
\titleformat{\subsection}[block]{\large \heiti}{\arabic{chapter}.\arabic{section}.\arabic{subsection}}{1em}{}[]
\titleformat{\subsubsection}[block]{\normalsize\bfseries}{\arabic{subsection}-\alph{subsubsection}}{1em}{}[]
\titleformat{\paragraph}[block]{\small}{[\arabic{paragraph}]}{1em}{}[]
% 使用Ctex自带的\section的标题会出现问题,使用titlesec\chapter的标题要么无法显示汉字数字,要么无法显示字母A,只能做缝合怪了!

\usepackage{gbt7714}
% 将参考文献的格式更改为与国标《文后参考文献著录规则》GB/T 7714-2005一致.
% 需要使用其它格式时请将该行注释, 并在参考文献部分将指定语句取消注释.
\usepackage{tikz}
\usepackage{pgf}

%导言区设置完毕
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\begin{document}
% 制作封面, 适用于研究生毕业论文.
\begin{titlepage}
    {
        \hfill 
        \footnotesize
   \begin{tabular}{cc}
        \makebox[4em][s]{学校代码}:&\makebox[5em][l]{10246}\\
        \makebox[4em][s]{学号}:&\makebox[5em][l]{20300180059}\\

    \end{tabular}
    }
    \vspace*{1.5cm}

    \begin{center}
        \begin{figure}[H] %H为当前位置,!htb为忽略美学标准,htbp为浮动图形
            \centering %图片居中
            \includegraphics[width=0.46\textwidth]{figs/fudan-name.pdf} %插入图片,[]中设置图片大小,{}中是图片文件名
            %\caption{Main name 0} %最终文档中希望显示的图片标题
            \label{fudan-name} %用于文内引用的标签
        \end{figure}
        \vspace*{1.5cm}

        \makebox[16em][s]{\LARGE{本科毕业论文}}
        %(学术学位)
        %若需要取消注释上一行,请相应改变下一行的行间距的取值
        \vspace*{3cm}

        {\bfseries \Large PBPK模型的参数反演: 基于深度学习算法}
        \vspace*{1cm}

       {\bfseries Parameter Inversion of PBPK Model: Based on Deep Learning Algorithm}
        \vspace*{3cm}

        \fontsize{14pt}{\baselineskip}\selectfont
        \begin{tabular}{cc}
            \makebox[6em][s]{院系}:&\makebox[8em][c]{数学科学学院}\\[1ex]
            \makebox[6em][s]{专业}:&\makebox[8em][c]{信息与计算科学}\\[1ex]
            \makebox[6em][s]{姓名}:&\makebox[8em][c]{许敬然}\\[1ex]
            %两个字姓名的同学可以将上一行改为
            %\makebox[6em][s]{姓名}:&\makebox[3em][c]{XX}\\[1ex]
            \makebox[6em][s]{指导老师}:&\makebox[8em][c]{陈文斌 \ 教授}\\[1ex]
            \makebox[6em][s]{完成日期}:&\makebox[8em][c]{\today}\\[1ex]
        \end{tabular}     
    \end{center}
\end{titlepage}

\renewcommand{\thepage}{\roman{page}}

% 改写目录标题的格式
\renewcommand{\contentsname}{目\quad 录}
\tableofcontents
\setcounter{page}{1}

\chapter*{摘\quad 要}
\addcontentsline{toc}{chapter}{摘要}
\normalsize

本研究旨在通过建立神经网络模型来实现对双酚S(BPS)在人体内的生理药代动力学模型(PBPK)内重要参数的反演, 以更快的速度与准确性完成模型的校准. 

首先, 本文介绍了PBPK模型的建立, 包括模型的实验与生理背景, 数学形式和求解方法. 随后, 本文详细阐述了使用固定时间节点数据与使用随机时间节点数据的PBPK模型参数反演神经网络方法, 并通过数据集结构与构建、网络模型架构、训练流程和效果展示等环节，展示了该方法的有效性。此外, 本文使用训练好的神经网络模型基于真实实验数据完成了PBPK模型的参数校准。最后, 本文评估了模型输出对校准后的皮肤三参数组的敏感度和不确定性.

本文通过数值实验证明了神经网络模型在PBPK模型框架下能够胜任参数反演与参数校准的任务, 并建议在使用神经网络模型作为校准工具的前提下, 研究者在人体实验中可以减少对受试者的采血采尿频次, 以降低成本. 



\noindent{\textbf{关键词:}} 双酚S(BPS); 生理药代动力学模型(PBPK);  深度学习 ;参数反演\\
\noindent{\textbf{CLC code:}} O24


\chapter*{Abstract}
\addcontentsline{toc}{chapter}{Abstract}
\normalsize

\iffalse
This study aims to establish a neural network model for the inversion of key parameters within the physiologically based pharmacokinetic (PBPK) model for bisphenol S (BPS) in the human body, to calibrate the model more rapidly and accurately.

Initially, this paper introduces the development of the PBPK model, including its experimental and physiological background, mathematical formulation, and solution methods. Subsequently, the paper elaborates on the neural network methods for PBPK model parameter inversion using both fixed and random time node data. The effectiveness of these methods is demonstrated through the construction of the dataset, the architecture of the network model, the training process, and the presentation of results. Additionally, this paper employs the trained neural network model to calibrate the PBPK model parameters based on real experimental data. Finally, the paper assesses the sensitivity and uncertainty of the model output  to the calibrated skin triplet parameters.

Through numerical experiments, this paper demonstrates that the neural network model is capable of performing parameter inversion and calibration tasks within the framework of the PBPK model. It is suggested that, with the neural network model as a calibration tool, researchers can reduce the frequency of blood and urine collection from subjects in human experiments, thereby reducing costs.
\fi

This study is dedicated to developing a neural network model to perform inverse parameter estimation of Bisphenol S (BPS) within a 
physiologically-based pharmacokinetic (PBPK) modeling framework, in the meantime,  to execute model calibration with enhanced speed and accuracy.

Initially, this paper introduces the construction of the PBPK model, including its experimental and physiological background, 
 mathematical formulation, and solving method. Subsequently, the paper elaborates on the approach of using neural networks for 
 parameter inversion, employing both fixed and random time-point data, and illustrating the efficacy of this method through the dataset structure,
  network model architecture, training process, and results exhibition. 
  Additionally, the well-trained neural network model is applied to perform parameter calibration of the PBPK model using actual experimental data. 
  Finally, the paper evaluates the sensitivity and uncertainty of the model output concerning the calibrated skin triplet parameters.
  
  Numerical experimentation confirms that the neural network model is apt for tasks of parameter inversion and calibration within the PBPK model 
  framework. The study further suggests that using neural networks as a calibration tool can potentially reduce the frequency of blood and urine 
  sampling in human trials, thereby decreasing costs.


\noindent{\textbf{Keywords:}} Bisphenol S (BPS); Physiologically Based Pharmacokinetic (PBPK) Model; Deep Learning; Parameter Inversion\\
\noindent{\textbf{CLC code:}} O24

\clearpage
\mbox{}
\thispagestyle{empty}
% 为了保证第一章在奇书页.




\renewcommand{\thepage}{\arabic{page}}
\setcounter{page}{0}
% 论文的页码从正文重新开始计数












\chapter{引言}

\section{研究背景} 
双酚类物质(Bisphenols,BPs)是一种工业用化学物质, 被大量用于生产聚碳酸酯及环氧树脂\cite{3}. 这两种可能会含有BPs的高分子物质又常被投入生产食品接触材料或其他日常使用材料, 例如塑料杯,奶瓶,纸币,金属涂层等\cite{4}.在日常生活中, BPs通过皮肤渗透与口服摄入两种主要途径进入人体内环境,参与后续的分布与代谢.双酚A(BPA),作为最早投入工业生产的BPs,已被证实对人体具有毒性\cite{2}.事实上,BPA会对人体的多个系统(如呼吸系统,神经系统,生殖系统)造成损害\cite{5}.
BPA与双酚S(BPS)两种BPs经口服进入人体后, 经消化系统来到小肠,并在此分别葡萄糖醛酸化为BPA-g与BPS-g, 葡萄糖醛酸化后的双酚物质会进入血液循环并最终随尿液排出体外;未葡萄糖醛酸化的BPA或BPS将会进入肝脏并在此被部分磷酸化为BPA-s或BPS-s,部分BPs在肝脏仍会被葡萄糖醛酸化,这些衍生物与未发生反应的BPs都会直接进入血液循环并最终随尿液排出体外\cite{2,1}.同时,在小肠或肝脏处进入血液循环的BPs会随血液进入人体的各个器官,如脑,生殖腺等.若BPs经由皮肤渗透进入人体,将会直接进入血液循环并跟随血液到达各个器官,其中进入小肠或肝脏的部分BPs将会根据所处位置被葡萄糖醛酸化或是被磷酸化.
为了找寻比BPA更安全的替代品, 研究BPS等双酚物质在人体中的代谢过程是有必要的\cite{6}.

生理药代动力学模型(Physiology-Based Pharmacokinetic Model, PBPK)是药学中定量描述化学品在人体中吸收,分布,代谢,排泄过程的经典模型,常被用于化学品生态风险评价,人类健康风险评估以及药物开发\cite{7}.PBPK模型将包含血浆在内的对目标化学品特异性较强的靶点组织器官抽象为一个个”房室”,以质量守恒定律和相关生化反应为基础定量计算目标化学品在各房室之间的交换与各房室之内的代谢过程\cite{8}.当某些靶点组织器官的目标化学品含量难以实际测出时, PBTK模型的结果能够提供一个良好的预测 \cite{7}.只需要确定PBPK模型中重要参数的数值, 就能在脱离实际人体实验的情况下给出人体吸收目标化学品后靶点组织器官的化学品含量.

\section{文献综述} 
Yang等人\cite{10}在2015年首次建立了使用人类参数的BPA在生物体内的PBPK模型,该模型基于口服摄入的吸收方式, 共设置了10个仓室,分别为血浆,肝脏,脂肪,性腺,血流丰富组织,血流缓慢组织,大脑和皮肤,剩下两个仓室分别是BPA-g和BPA-s的反应仓室. 为了校准模型, Yang等人设立了成年人类口服BPA的人体实验并记录了受试者尿液中的BPA的含量信息, 借助真实数据, 研究者使用视觉拟合与传统优化算法对PBPK模型中与肝脏有关的参数进行了优化校准. 最后, Yang等人利用敏感性分析与不确定性分析评估了模型.

Karrer等人\cite{9}在2018年重新调整了此PBPK模型, 提供了BPA的其他双酚类替代品的模型参数, 并增加了通过皮肤渗透吸收BPs的情形. Karrer等人利用人体BPS接触实验的血液与尿液数据完成了对模型结构的调整, 并同样使用了视觉拟合与传统优化算法对部分参数进行了调整, 最终也使用敏感性与不确定性分析评估了模型.

Hu等人\cite{11}在2023年对皮肤渗透模型进行了改进, 在原本皮肤作为单独仓室的基础上将其分割成了五个小仓室, 分别为表皮储仓, 角质层, 活性表皮, 毛囊以及未参与渗透吸收的未暴露皮肤.
该文章也设置了志愿者实验, 利用BPS暴露后受试者尿液中BPS与BPS-g的含量来优化PBPK模型与皮肤仓室相关的三个参数, 并使用敏感性与不确定性分析评估了修改后的PBPK模型.

在前人关于BPS的人体PBPK模型的研究中, 普遍使用传统优化算法完成模型的校准与调参. 校准后, 使用敏感性分析与不确定性分析两种手段分析模型的稳定性.
\section{研究目标与文章结构} 

Hu等人\cite{11}文章的参数优化部分中使用的算法需要较长的迭代进程, 且不确定性分析中的蒙特卡洛模拟需要对模型进行上万次的计算, 在计算机上运行的时间较久, 有较大的优化空间. 
鉴于此, 本研究旨在开发一种基于深度学习算法的神经网络模型, 以实现对PBPK模型中关键参数的快速准确反演. 本研究的主要目标与创新点包括：

1.基于Python代码完成PBPK模型的求解, 在Hu等人的基础上得到了更快的运行速度; 

2.构建深度学习框架下的神经网络模型, 实现对PBPK模型参数的反演;

3.利用真实实验数据, 使用训练好的神经网络完成PBPK模型参数的校准, 提供了一个新的PBPK模型校准的可行方法;

4.评估校准后模型的敏感性和不确定性，为实验设计和风险评估提供参考.

本文按照PBPK模型的求解, 参数校准与统计学分析的顺序展开, 文章的结构安排如下: 第二章介绍PBPK模型的背景, 建立和求解;
第三章和第四章分别讲述了使用固定或随机时间节点数据的参数反演神经网络; 第五章进行PBPK模型的统计学分析; 最后一章为总结.



\chapter{PBPK模型的建立}
Hu等人\cite{11}在github中共享了论文中的数据以及部分代码. 共享中包含了PBPK模型和参数优化所使用的受试者真实数据等, 本章内容参照了这些工作.该模型对多种双酚类物质都适用, 本文后续只讨论
双酚S(BPS)的情形, 且只考虑皮肤暴露途径的外源BPS输入.

2.1节与2.2节整体介绍了PBPK模型的生理背景与数学形式, 2.3节介绍了PBPK模型的求解并展示了本文的模型求解结果与Hu等人\cite{11}求解结果的对比.
\section{模型的实验与生理背景}
Hu\cite{11}等人通过使用含有氘代BPS(BPS-d8)的热敏纸摩擦手指的方式令受试者暴露于BPS.受试者接触热敏纸共$\frac{1}{6}h$, 脱离热敏纸后再等待$2h$, $\frac{13}{6}h$时彻底清洗皮肤,清空表皮储仓内的BPS.
在接触实验开始的$72h$内, 受试者被要求每$4.3h$左右提供一次尿液样本, 以检测尿液中的BPS与BPS-g的含量(不检测BPS-s的尿液含量, 因为缺少相应的检测试剂).
在另一个BPS人体接触实验中, Khmiri等人\cite{13}同时监测了受试者的血液与尿液. 接触BPS起的前$2h$内每$0.25h$取样一次血液, 第2小时至第8小时内每$1h$取样一次血液, 之后分别在$10h$, $24h$, $48h$时取样一次血液.
尿液的取样节点不是固定的, 而是将接触BPS后$48h$分成了11个时段. 受试者在单个时段内的所有排尿都会被收集,作为该时段标签下的一个整体取样. 

根据Hu等人的文章\cite{11}, 从受试者与热敏纸接触时起, 热敏纸内的BPS通过手指表皮储仓进入毛囊和角质层, 接着扩散进入活性表皮层, 再通过毛囊和活性表皮层与内环境的交换进入体循环, 平行分层皮肤仓室内的物质交换情况的图片形式如图\ref{分层皮肤}. 血浆携带BPS通过血液交换将
其送入肝脏, 脑, 脂肪, 性腺等组织器官. 部分BPS在肝脏反应为BPS-g或BPS-s.体内的BPS-g与BPS-s不会再反应为其他物质, 这两种物质
会像始终未发生反应的BPS一样, 最终随血液进入肾脏, 通过尿液排出. 在只有皮肤暴露途径吸收外源BPS的情况下, 不考虑BPS的肝肠循环过程, 认为胃肠部不存在BPS, 且小肠不发生BPS葡萄苷酸化为BPS-g的反应. 
整个PBPK模型的仓室间BPS, BPS-g, BPS-s的交换情况如图\ref{模型图解}所示.
\begin{figure}[H]
  \centering
  \includegraphics[scale=0.54]{./figs/p1.png}
  \caption{平行分层皮肤仓室的简化图解(箭头代表BPS的可能运输方向)}
  \label{分层皮肤}
\end{figure}

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.6]{./figs/p2.png}
  \caption{BPS人体内PBPK模型的简化图解(箭头代表BPS的可能运输方向)}
  \label{模型图解}
\end{figure}
\section{模型的数学形式}
本文中的PBPK模型共有个14仓室,包括:暴露皮肤\{皮肤表皮储仓, 角质层, 毛囊, 活性表皮层\}, 胃, 小肠, 未暴露于化学品的皮肤, 血浆, 脂肪, 性腺, 肝脏, 脑, 血流丰富组织, 血流缓慢组织.
其中暴露的含义为“在实验中与BPS接触”.
根据各仓室之间的关系以及BPS在各仓室内的生化反应, 得到19个常微分方程与1个偏微分方程. 这些微分方程共同构成了BPS的带平行分层皮肤仓室的PBPK模型.  

\subsubsection*{角质层内BPS的浓度$\varphi(x,t)$}
如(\ref{eq0}), 其中的偏微分方程本质上是一个扩散对流方程,其解$\varphi$代表角质层(Stratum Corneum)中BPs的浓度, 自变量$x$代表角质层的深度, 自变量$t$代表时间, $DSC$代表BPS在角质层中的有效扩
散系数$(cm^2/h)$, $u_1$代表BPS随脱屑向皮肤表面转移的速度$(cm/min)$, $T_{SC}$代表角质层的深度$(um)$, $HSC_{well}$代表角质层和皮肤表皮储仓之间的分配系数, 
$C_{well}(t)$代表皮肤表皮储仓在$t$时刻的BPS浓度$(nmol/cm^3)$, $HSC_{VE}$代表角质层和活性表皮之间的分配系数, $C_{VE}(t)$代表活性表皮在$t$时刻的BPS浓度$(nmol/cm^2)$:

\begin{equation}\label{eq0}
  \left\{\begin{aligned}
    \frac{\partial \varphi(x,t) }{\partial t^2} &= DSC \frac{\partial^2 \varphi(x,t)}{\partial x^2} + u_1 \frac{\partial \varphi(x,t)}{\partial x}, && 0\leq x \leq T_{SC}, \quad t\geq 0,\\
    \varphi(0,t) &= HSC_{well} \times C_{well}(t), &&t\geq 0,\\
    \varphi(T_{SC},t) &= HSC_{VE} \times C_{VE}(t), &&t\geq 0,\\
    \varphi(x,0) &= 0, &&0\leq x \leq T_{SC}.\\
  \end{aligned}\right.
  \end{equation}
\noindent 使用空间离散化的办法, 将角质层视作一个长度为$T_{SC}$的线段, 将该线段等距分为$10$段, 共$11$个节点$\{x_i\}_{0\leq i\leq 10}$. 其中第一个节点$x_0$视作皮肤表皮储仓, 最后一个节点$x_{10}$视作活性表皮.
$x_1$至$x_9$九个节点处BPS浓度的一阶与二阶空间导数值通过中心差分法近似表示: 
\begin{equation}\label{eq1.1}
  \left\{\begin{aligned}
    \frac{\partial^2}{\partial x^2}\varphi(x_j, t) &\approx \frac{\varphi_{j+1}(t) - 2\varphi_j(t) + \varphi_{j-1}(t)}{(\Delta x)^2}\\
    \frac{\partial}{\partial x}\varphi(x_j, t) &\approx \frac{\varphi_{j+1}(t) - \varphi_{j-1}(t)}{2\Delta x}\\
  \end{aligned}\right.
  \end{equation}
  \noindent 整理后得到这九个节点处BPS浓度关于时间的一阶导数值如(\ref{eq1}), $i=2,3,\dots,8$与(\ref{eq2}),(\ref{eq3}).其中$SCDX = \frac{T_{SC}}{10}$, 
  $V_{well}$为暴露皮肤表面储仓沉积体积$(cm^3)$, $A_{well}(t)$为皮肤表皮储仓在$t$时刻的BPS含量$(nmol)$,$V_{TVE}$为暴露皮肤活性表皮层体积$(cm^3)$, $A_{VE}(t)$为活性表皮在$t$时刻的BPS含量$(nmol)$.
  节点$x_1$和$x_9$处的时间导数值与其他节点不同的原因是: 与它们相邻的部分涉及到皮肤的不同层室,需要利用BPS在不同层室组织间
  的分配系数来确定两个不同层室间BPS的转移情况. 
\begin{multline}\label{eq1}
  \frac{dC_{SCi}(t)}{dt}=\left(\frac{DSC}{SCDX^2} -\frac{u_1}{2 \times  SCDX}\right)C_{SCi-1}(t)-\frac{2 \times DSC}{SCDX^2}  C_{SCi}(t)\\
  +\left(\frac{DSC}{SCDX^2}+\frac{u_1}{2 \times  SCDX}\right)C_{SCi+1}(t).
\end{multline}

\begin{multline}\label{eq2}
  \frac{dC_{SC1}(t)}{dt}=\left(\frac{DSC \times  HSC_{well}}{V_{well}  \times  SCDX^2 }-\frac{u_1  \times  HSC_{well}}{V_{well}  \times  2 \times  SCDX}\right)A_{well}(t)   -\frac{2 \times DSC}{SCDX^2}  C_{SC1}(t)\\
  +\left(\frac{DSC}{SCDX^2}+\frac{u_1}{2 \times  SCDX}\right)C_{SC2}(t).
\end{multline}

\begin{multline}\label{eq3}
  \frac{dC_{SC9}(t)}{dt}=\left(\frac{DSC}{SCDX^2} -\frac{u_1}{2 \times  SCDX}\right)C_{SC8}(t)-\frac{2 \times DSC}{SCDX^2}  C_{SC9}(t)\\
  +\left(\frac{DSC \times  HSC_{VE}}{V_{TVE}  \times  SCDX^2 }-\frac{u_1  \times  HSC_{VE}}{V_{TVE}  \times  2 \times  SCDX}\right)A_{VE}(t) .
\end{multline}

接下来介绍模型中余下的19个描述不同仓室内BPS分布与代谢的常微分方程, 此部分内方程中出现的变量与常量的含义详情见附录\ref{app:B}.
\subsubsection*{毛囊内BPS的含量$A_{Fo}(t)$}
见(\ref{eq10}), 方程等式两端为$A_{Fo}(t)$的一阶导数. 在该PBPK模型中, 毛囊与皮肤表皮储仓和血液之间有着直接的物质交换, 故毛囊内BPS含量的增减与表皮储仓或血浆中BPS的含量有关, BPS在宏观上遵循着顺浓度梯度运输的
规则在不同组织内交换. 同时, 毛囊内BPS含量的增减会受到自身的限制, 当毛囊内BPS浓度高于血浆或表皮储仓中BPS浓度时, BPS会顺浓度梯度进入浓度小的组织.
\begin{multline}\label{eq10}
  \frac{dA_{Fo}(t)}{dt} = -\left(\frac{Pfo \times  AEXP \times  FEXP}{V_{TFo}  \times  HFo_{well} }
  +\frac{Qskin \times  AEXP \times  0.25}{BSA \times  V_{TFo}  \times  pskin}\right)A_{Fo}(t)\\
  +\frac{Pfo \times  AEXP \times  FEXP}{V_{well}  }A_{well}(t)+\frac{Qskin \times  AEXP \times  0.25}{BSA \times  V_{plasma}} A_{plasma}(t).
\end{multline}

\subsubsection*{皮肤表皮储仓内BPS的含量$A_{well}(t)$}
见(\ref{eq11}), 方程等式两端为$A_{well}(t)$的一阶导数. 类似(\ref{eq10}), 等式右端表现出了表皮储仓与节点$x_1$处的角质层和毛囊之间的顺浓度梯度物质交换关系. 同时, 皮肤表皮储存作为在实验
中直接和外源BPS接触的部位, 它要接受一个剂量为$f_1 (t)$(单位:nmol)的持续的外源BPS输入. 当$t>Time_{add}=\frac{1}{6}h$时, 皮肤停止接触外源BPS, $f_1 (t)=0$. 
等式右端有一个因数$ON(t)$, 当$t\leq Time_{expose}=\frac{13}{6}h$时, $ON(t)=1$, 皮肤处于BPS暴露状态;当$t> Time_{expose}$时, $ON(t)=0$, 暴露过BPS的皮肤被彻底清洗, 表皮储仓清空, 后续$A_{well}(t)$的值与一阶
导数值都为0.
\begin{multline}\label{eq11}
  \frac{dA_{well}(t)}{dt} = \left(\frac{DSC \times  AEXP \times  (1-FEXP)}{SCDX} C_{SC1}(t)-\frac{Pfo \times  AEXP \times  FEXP}{V_{TFo} \times  HFo_{well}} A_{Fo}(t)\right.\\
  \left. -\left(\left(\frac{DSC \times  HSC_{well}}{V_{well} \times  SCDX}-\frac{u_1 \times  HSC_{well}}{V_{well} }\right) \times  AEXP \times  (1-FEXP) \right.\right.\\
  \left.\left.-\frac{Pfo \times  AEXP \times  FEXP}{V_{well}} \right)A_{well}(t)+f_1 (t) \right) \times  ON(t).
\end{multline}

\subsubsection*{活性表皮层内BPS的含量$A_{VE}(t)$}
见(\ref{eq12}), 方程等式两端为$A_{VE}(t)$的一阶导数. 类似(\ref{eq10}), 等式右端表现出了活性表皮层与节点$x_9$处的角质层, 毛囊和血浆之间的顺浓度梯度物质交换关系. 
\begin{multline}\label{eq12}
  \frac{dA_{VE}(t)}{dt}=\frac{DSC \times  AEXP \times  (1-FEXP)}{SCDX} C_{SC9}(t)+\left(\left(\frac{-DSC \times  HSC_{VE}}{V_{TVE}  \times  SCDX}-\frac{u_1  \times  HSC_{VE}}{V_{TVE} }\right)\times \right.\\ 
   \left.AEXP \times  (1-FEXP)-\frac{Qskin \times  AEXP \times  0.75}{BSA \times  V_{TVE}  \times  pskin}\right)A_{VE}(t)+\frac{Qskin \times  AEXP \times  0.75}{BSA \times  V_{plasma} } A_{plasma}(t).
\end{multline}

\subsubsection*{胃部BPS的含量$A_{ST}(t)$}
见(\ref{eq13}), 方程等式两端为$A_{ST}(t)$的一阶导数. 等式右端的第一个加数代表胃部BPS向肝脏和小肠转移的过程, 第二个加数是剂量为$f_2 (t)$(单位:nmol)的通过口服吸收的外源BPS. 但由于本文不考虑
口服吸收BPS的情形, $f_2 (t)\equiv 0$, 可认为胃部内始终不含有BPS或它的衍生物.
\begin{equation}\label{eq13}
  \frac{dA_{ST}(t)}{dt}=-(k_0+ge)A_{ST}(t)+f_2 (t).
\end{equation}
\subsubsection*{未暴露于BPS的皮肤, 脂肪, 性腺, 脑部, 血流丰富组织, 血流缓慢组织的BPS的含量}
见(\ref{eq14})至(\ref{eq20}), 各方程的等式两端为小标题中组织器官内BPS含量的一阶导数. 这些等式的右端一致地代表了对应组织器官与血浆之间的顺浓度梯度物质交换关系. 
\begin{multline}\label{eq14}
  \frac{dA_{skin}(t)}{dt}=\frac{-Qskin \times  (1-\frac{AEXP}{BSA})}{(V_{skin}-V_{TSC}-V_{TVE}-V_{TFo}) \times  pskin} A_{skin}(t)+\frac{Qskin \times  (1-\frac{AEXP}{BSA})}{V_{plasma}}  A_{plasma}(t).
\end{multline}

\begin{equation}\label{eq15}
  \frac{dA_{fat}(t)}{dt}=\frac{-Qfat}{V_{fat}  \times  pfat} A_{fat}(t)+\frac{Qfat}{V_{plasma}}  A_{plasma}(t).
\end{equation}

\begin{equation}\label{eq16}
  \frac{dA_{gonad}(t)}{dt}=\frac{-Qgonad}{V_{gonad}  \times  pgonad} A_{gonad}(t)+\frac{Qgonad}{V_{plasma}}  A_{plasma}(t).
\end{equation}

\begin{equation}\label{eq18}
  \frac{dA_{brain}(t)}{dt}=\frac{-Qbrain}{V_{brain}  \times  pbrain} A_{brain}(t)+\frac{Qbrain}{V_{plasma}}  A_{plasma}(t).
\end{equation}

\begin{equation}\label{eq19}
  \frac{dA_{rich}(t)}{dt}=\frac{-Qrich}{V_{rich}  \times  prich} A_{rich}(t)+\frac{Qrich}{V_{plasma}}  A_{plasma}(t).
\end{equation}

\begin{equation}\label{eq20}
  \frac{dA_{slow}(t)}{dt}=\frac{-Qslow}{V_{slow}  \times  pslow} A_{slow}(t)+\frac{Qslow}{V_{plasma}}  A_{plasma}(t).
\end{equation}

\subsubsection*{血浆内的BPS的含量}
见(\ref{eq17}), 方程等式两端为血浆内BPS含量的一阶导数. 血浆是体循环的重要组成部分, 该PBPK模型内的各仓室由血浆连接起来, 几乎每个仓室都与血浆有直接的物质交换, BPS从组织器官内进入血浆, 血浆又
携带着BPS进入各个组织器官. 等式的右端代表了血浆与毛囊, 活性表皮层, 未直接暴露于BPS的皮肤组织, 脂肪, 性腺, 脑部, 血流丰富组织, 血流缓慢组织, 肝脏之间的顺浓度梯度物质交换关系. 
等式右端除了$A_{plasma}(t)$项外每一项都有因数$Qc-Kurinebps$, 其中$Qc$是心脏血流速度$(L/h)$, $Kurinebps$是BPS的尿液排泄参数$(L/h)$, 它们相减代表了每轮血液循环净剩的携带了BPS的血浆量.
\begin{multline}\label{eq17}
  \frac{dA_{plasma}(t)}{dt}=\frac{(Qc-Kurinebps) \times  Qskin \times  \frac{AEXP}{BSA} \times  0.25}{Qc \times  V_{TFo}  \times  pskin} A_{Fo}(t)\\
  +\frac{(Qc-Kurinebps) \times  Qskin \times  \frac{AEXP}{BSA} \times  0.75}{Qc \times  V_{TVE}  \times  pskin} A_{VE}(t)\\
  +\frac{(Qc-Kurinebps) \times  Qskin \times  (1-\frac{AEXP}{BSA})}{Qc \times  (V_{skin}-V_{TSC}-V_{TVE}-V_{TFo}) \times  pskin} A_{skin}(t)\\
  +\frac{(Qc-Kurinebps) \times  Qfat}{Qc \times  V_{fat}  \times  pfat} A_{fat}(t)
  +\frac{(Qc-Kurinebps) \times  Qgonad}{Qc \times  V_{gonad}  \times  pgonad} A_{gonad}(t)\\
  -\frac{Qc}{V_{plasma}}  A_{plasma}(t)+\frac{(Qc-Kurinebps) \times  Qbrain}{Qc \times  V_{brain} \times  pbrain} A_{brain}(t)\\
  +\frac{(Qc-Kurinebps) \times  Qrich}{Qc \times  V_{rich}  \times  prich} A_{rich}(t)
  +\frac{(Qc-Kurinebps) \times  Qslow}{Qc \times  V_{slow}  \times  pslow} A_{slow}(t)\\
  +\frac{(Qc-Kurinebps) \times  Qliver}{Qc \times  V_{liver} \times  pliver} A_{liver}(t).
\end{multline}

\subsubsection*{胃肠部的BPS-g的含量$A_{GIBPSg}(t)$与胃肠部的BPS-s的含量$A_{GIBPSs}(t)$}
见(\ref{eq21}), 方程等式两端为胃肠部的BPS-g的含量的一阶导数. 等式右端的第二个加数代表了小肠内的BPS葡萄苷酸化为BPS-g的过程, 第一个加数代表了BPS-g从胃肠部进入血液的过程. 
在本文中, 没有口服吸收途径, 认为胃肠部不存在BPS-g或BPS-s. 对于(\ref{eq22})有类似的说明, 不同在于小肠内几乎不发生BPS硫酸盐化为BPS-s的反应.
\begin{equation}\label{eq21}
  \frac{dA_{GIBPSg}(t)}{dt}=-kGIing \times  A_{GIBPSg}(t)+\frac{Vmaxgutg \times  A_{SI}(t)}{enterocytes \times  Kmgutg+A_{SI}(t)+\frac{A_{SI}(t)^2}{enterocytes \times  Ksigutg}}.
\end{equation}

\begin{equation}\label{eq22}
  \frac{dA_{GIBPSs}(t)}{dt}=-kGIins \times  A_{GIBPSs}(t)+\frac{Vmaxguts \times  A_{SI}(t)}{enterocytes \times  Kmguts+A_{SI}(t)}.
\end{equation}
\subsubsection*{小肠的BPS的含量$A_{SI}(t)$}
见(\ref{eq23}), 方程等式两端为小肠的BPS的含量的一阶导数. 等式右端的第一个加数代表了口服BPS时胃部BPS进入小肠的过程, 第二个加数代表了小肠内部分BPS进入肝脏的过程, 后两个加数代表了部分BPS在小肠内葡萄苷酸化为BPS-g与硫酸盐化为BPS-s的反应过程
(小肠内几乎不发生BPS磷酸盐化反应, 此处对应的最大反应速率$Vmaxguts$非常小). 
在本文中, 没有口服吸收BPS的途径, 认为小肠内不存在BPS及其衍生物. 
\begin{multline}\label{eq23}
  \frac{dA_{SI}(t)}{dt}=ge \times  A_{ST}(t)-k1 \times  A_{SI}(t)-\frac{Vmaxgutg \times  A_{SI}(t)}{enterocytes \times  Kmgutg+A_{SI}(t)+\frac{A_{SI}(t)^2}{enterocytes \times  Ksigutg}}\\
  -\frac{Vmaxguts \times  A_{SI}(t)}{enterocytes \times  Kmguts+A_{SI}(t)}.
\end{multline}
\subsubsection*{肝脏的BPS的含量$A_{liver}(t)$}
见(\ref{eq24}), 方程等式两端为肝脏的BPS的含量的一阶导数. 等式右端的前两个加数分别代表了口服BPS时胃部和小肠内BPS进入肝脏的过程, 第三第四个加数代表了肝脏与血浆之间的顺浓度梯度物质交换关系, 第五第六个加数代表了
BPS-g与BPS-s引起肝脏内部分BPS发生肝肠循环的过程, 后两个加数代表了部分BPS在肝脏内葡萄苷酸化为BPS-g与硫酸盐化为BPS-s的反应过程. 
\begin{multline}\label{eq24}
  \frac{dA_{liver}(t)}{dt}=k0 \times  A_{ST}(t)+k1 \times  A_{SI}(t)+\frac{Qliver}{V_{plasma} } A_{plasma}(t)-\frac{Qliver}{V_{liver}  \times  pliver} A_{liver}(t)\\
  +kenterobpsg \times  A_{BPSg\_delay}(t)+kenterobpss \times  A_{BPSs\_delay}(t)\\
  -\frac{Vmaxliverg \times  A_{liver}(t)}{V_{liver}  \times  pliver \times  Kmliverg+A_{liver}(t)}-\frac{Vmaxlivers \times  A_{liver}(t)}{V_{liver}  \times  pliver \times  Kmlivers+A_{liver}(t)}.
\end{multline}

\subsubsection*{发生肝肠循环/小肠内的BPS-g/BPS-s的量$A_{BPSg\_delay}(t)$/$A_{BPSs\_delay}(t)$}
见(\ref{eq25}), 方程等式两端为发生肝肠循环的BPS-g的量的一阶导数. 等式右端的第一个加数代表了胃肠部BPS-g进入血浆后再进入肝肠循环的过程,第二个加数代表了肝肠循环中的BPS-g进入血液循环的过程, 最后一个加数
代表了肝脏中BPS新转化成的BPS-g进入肝肠循环的过程. 对于发生肝肠循环的BPS-s的量的方程(\ref{eq26}), 有着完全一致的描述.
\begin{multline}\label{eq25}
  \frac{dA_{BPSg\_delay}(t)}{dt}=met2g \times  kGIing \times  A_{GIBPSg}(t)\\
  -(kentero+k4_{IV}+kenterobpsg) \times  A_{BPSg\_delay}(t)
  +\frac{met2g \times  Vmaxliverg \times  A_{liver}(t)}{V_{liver}  \times  pliver \times  Kmliverg+A_{liver}(t)}.
\end{multline}

\begin{multline}\label{eq26}
  \frac{dA_{BPSs\_delay}(t)}{dt}=met2s \times  kGIins \times  A_{GIBPSs}(t)\\
  -(kentero+k4_{IV}+kenterobpss) \times  A_{BPSs\_delay}(t)
  +\frac{met2s \times  Vmaxlivers \times  A_{liver}(t)}{V_{liver}  \times  pliver \times  Kmlivers+A_{liver}(t)}.
\end{multline}

\subsubsection*{人体内BPS-g/BPS-s的总含量$A_{BPSg}(t)$/$A_{BPSs}(t)$}
见(\ref{eq27}), 方程等式两端为人体内BPS-g的总含量的一阶导数. 等式右端的第一个加数代表了口服摄入BPS时, 胃肠部产生的BPS-g进入血液后未进入肝肠循环的部分BPS-g, 第二个加数代表了正在进行肝肠循环的BPS-g, 第三个
加数代表了BPS-g随尿液排出人体的过程, 最后一个加数代表了BPS通过肝脏转化成的BPS-g进入血液后未进入肝肠循环的部分BPS-g.(\ref{eq28})与之相似.

\begin{multline}\label{eq27}
  \frac{dA_{BPSg}(t)}{dt}=met1g \times  kGIing \times  A_{GIBPSg}(t)+kentero \times  A_{BPSg\_delay}(t)-\frac{Kurinebpsg}{Vbodyg+10^{-34} } A_{BPSg}(t)\\
  +\frac{met1g \times  Vmaxliverg \times  A_{liver}(t)}{V_{liver}  \times  pliver \times  Kmliverg+A_{liver}(t)}.
\end{multline}

\begin{multline}\label{eq28}
  \frac{dA_{BPSs}(t)}{dt}=met1s \times  kGIins \times  A_{GIBPSs}(t)+kentero \times  A_{BPSs\_delay}(t)-\frac{Kurinebpss}{Vbodys+10^{-34}} A_{BPSs}(t)\\
  +\frac{met1s \times  Vmaxlivers \times  A_{liver}(t)}{V_{liver}  \times  pliver \times  Kmlivers+A_{liver}(t)}.
\end{multline}

综上, 本文的PBPK模型的数学形式的主要部分为一个由28个常微分方程构成的微分方程组, 每个解的初值都是0.
除此之外, 根据实验过程, 还需计算尿液中的BPS与BPS-g的在$t$时刻的含量$A_{urinebps}(t)$与$A_{urinebpsg}(t)$, (\ref{eq29})与(\ref{eq30})给出了它们的一阶导数值.
这两个等式都不是常微分方程.
\begin{multline}\label{eq29}
  \frac{dA_{urinebps}(t)}{dt}=Kurinebps\times \left(\frac{  Qskin \times  \frac{AEXP}{BSA} \times  0.25}{Qc \times  V_{TFo}  \times  pskin} A_{Fo}(t)
  +\frac{  Qskin \times  \frac{AEXP}{BSA} \times  0.75}{Qc \times  V_{TVE}  \times  pskin} A_{VE}(t)\right.\\
  \left.+\frac{  Qskin \times  (1-\frac{AEXP}{BSA})}{Qc \times  (V_{skin}-V_{TSC}-V_{TVE}-V_{TFo}) \times  pskin} A_{skin}(t)\right.\\
  \left.+\frac{  Qfat}{Qc \times  V_{fat}  \times  pfat} A_{fat}(t)
  +\frac{  Qgonad}{Qc \times  V_{gonad}  \times  pgonad} A_{gonad}(t)\right.\\
  \left.+\frac{  Qbrain}{Qc \times  V_{brain} \times  pbrain} A_{brain}(t)
  +\frac{  Qrich}{Qc \times  V_{rich}  \times  prich} A_{rich}(t)\right.\\
  \left.+\frac{  Qslow}{Qc \times  V_{slow}  \times  pslow} A_{slow}(t)
  +\frac{  Qliver}{Qc \times  V_{liver} \times  pliver} A_{liver}(t)\right).
\end{multline}

\begin{equation}\label{eq30}
  \frac{dA_{urinebpsg}(t)}{dt}=\frac{Kurinebpsg}{Vbodyg+10^{-34} } A_{BPSg}(t).
\end{equation}
\section{PBPK模型的求解}
确定模型的数学形式后, 将Hu等人\cite{11}提供的数据相对应地代入至方程的各个参数, 使用Python中的第三方库函数scipy.integrate.odeint()对
微分方程组求解, 该函数默认使用LSODA数值格式. LSODA是一种高效的支持自适应步长的算法\cite{14}, 根据设置好的误差限度, 若按照原有的预设步长来进行下一节点的数值计算, 得到的误差大于限度, 则将此步预设步长拆分为更小的多个步长, 
以此来减小误差至限度以内; 若按照预设步长计算时得到的误差远小于限度, 则适当增大步长以减小资源消耗. 同时, LSODA同时支持刚性与非刚性问题, 处理刚性问题时, 它使用后向微分公式(BDF),处理非刚性问题时, 它使用Runge-Kutta公式.

根据Hu等人\cite{11}的实验, 每个解的初值都设置为0, 时间网格设置为$range(0,75,0.005)$, 时间步长为$0.005h$, 共$15000$个时间节点.
每个方程的解都对应了一条人体某组织器官内BPS(或BPS-g, BPS-s)的含量$(mmol)$或浓度$(mmol/L)$随时间变化的曲线.

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.6\textwidth}
    \centering
    \includegraphics[scale=0.5]{./figs/p9_1.png}
    \caption{$A_{plasma}(t)$的相对误差的十进对数}
  \end{subfigure}
  \begin{subfigure}{0.6\textwidth}
    \centering
    \includegraphics[scale=0.5]{./figs/p9_2.png}
    \caption{$A_{urinebps}(t)$的相对误差的十进对数}
  \end{subfigure}
  \caption{与前人PBPK模型计算出的结果的相对误差}
  \label{PBPK模型结果对比}
\end{figure}


图\ref{PBPK模型结果对比}展示了本文的模型数值求解结果与参考代码\cite{11}中结果中$A_{plasma}(t)$与$A_{urinebps}(t)$的相对误差, 可以看到
两种绝对误差曲线的数值都来到了$10^{-7}$这一量级附近, 说明对Hu等人\cite{11}提出的模型的求解复现效果较好.
分别运行100次前人模型求解代码与本文复现的模型求解代码, 取单次运行的平均, 得到本文的模型求解代码的单次平均运行时间为$0.1086s$, 前人的代码单次平均运行时间为$18.1621s$,
本文复现代码的运行速度约为前人速度的$167$倍.


\chapter{PBPK模型参数反演的神经网络方法: 使用固定时间节点数据}

本章使用了对偶学习的方法建立了使用固定时间节点数据的用于参数反演的神经网络模型. 本章首先在3.1节介绍了本章神经网络模型的功能与作用, 在3.2节介绍了网络模型训练所需的数据集的结构与构建, 接下来在3.3节和3.4节分别
讲述了本章神经网络模型的架构与训练, 在3.5节详细介绍了对偶学习在本文的具体应用, 最后在3.6节展示了本章网络模型在测试集上的效果.
\section{参数反演的背景与网络模型的基本介绍}
\label{3.1}
Hu等人\cite{11}在原本人体关于BPs的PBPK模型的基础上创新了平行分层仓室模型, 该部分仓室模型在参数的数值确定方面还不完善, 需要借助人体实验得到的真实数据对
该部分参数进行反演校准. 
需要反演校准的与皮肤仓室有关的参数有三个, 称由这三个参数的取值组成的一个数组为\textit{皮肤三参数组合}, 它们分别为:

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{|c*{1}{l}}

    $DSC$ &: 角质层中的有效扩散系数$(cm^2/h)$, \\ 
  
    $u_1$  &: 由脱屑而向皮肤表面转移的速度$(cm/min)$, \\ 
  
    $Pfo$ &: 毛囊的渗透系数$(cm/h)$ .\\ 

  \end{tabular}
\end{table}  

如实验背景介绍中的内容, 受试者在接受BPS的皮肤接触后, 需要在实验进行的$75h$内收集每次排出的尿液\cite{11}. 研究者需测量尿液中BPS与BPS-g的
累计含量$(mmol)$, 具体做法为: 对于单次排尿, 首先记录排尿时间, 然后测量本次排出尿液的化学品含量, 对截止至本次(包括本次)的全部排尿中的化学品含量累计求和, 
将得到的求和数值作为本次排尿时间节点处的受试者尿液中BPS或BPS-g的累计含量, 这样就得到了单次排尿的$(\textit{排尿时间}t_i, \textit{尿液累计化学品含量}A_i)$. 
将这样得到的所有数据点绘制在\textit{含量-时间}坐标系内, 可得到一幅散点图. 

为了校准模型参数, 需要使PBPK模型计算出的尿液中BPS与BPS-g含量之和的曲线拟合散点图中的散点. Hu等人\cite{11} 设置损失函数为真实受试者尿液化学品含量与PBPK模型结果中的尿液化学品含量之间的$MSE$
, 以三个待优化的参数为目标, 利用R语言中的优化函数optim()最小化损失函数. 函数的输出即为参数的校准值. 

另外, 根据Khmiri等人\cite{13}的研究, 对受试者在固定时间节点采集血浆样本, 并分析其中的BPS含量, 将损失函数设置为真实受试者血药含量与PBPK模型结果中的血药含量之间的$MSE$, 也是一种参数校准的手段.
相对于人体其他组分, 血浆或尿液更容易获取与分析化学性质. 两种手段都以PBPK模型的输出类型之一为参照物, 通过实验获得真实数据, 与模型输出数据进行对比, 以此来指导模型内部分参数的校准.

给定血药含量或尿药含量关于时间变化曲线上的散点, 反演得到模型内的三个参数. 基于这样的参数反演流程, 本文使用了神经网络模型来辅助PBPK模型的参数校准, 在传统优化算法之外提供了一种更有效且更快速的方法.
本章介绍的是基于Hu等人\cite{11}提出的PBPK模型与模型参数数值, 使用固定时间采样点数据训练的皮肤三参数反演神经网络模型. 其中固定时间采样点的意思是, 
假设在理想情况下, 研究者能严格按照某组合理的预设时间节点采集受试者的血液与尿液. 该神经网络模型可以接收在固定时间点处采集的血浆和尿液中的BPS或BPS-g的含量, 也可以接收PBPK模型输出的血药含量, 尿药含量曲线
在固定时间点处的采样点, 网络模型输出反演后的皮肤三参数组合. 该网络的数据集结构并未完全参考Hu等人\cite{11}的参数校准过程, 利用真实数据校准参数的网络模型将会在下一章介绍.

\section{参数反演神经网络模型的数据集结构与构建}
\label{3.2}

\subsection{网络功能与数据集结构介绍}
数据集的结构直接决定了网络的输入与输出数据的形状, 间接决定了网络的功能与效果, 同时网络功能的实现又需要设计合适的数据集结构, 故在此一齐介绍.

首先, 认为PBPK模型中除了皮肤三参数组合外的其他参数都已确定为常数, 并固定求解模型中微分方程组的时间格点与初值, 设置皮肤三参数组合为PBPK模型的求解模型的唯一输入, 
将整个PBPK模型的求解模型抽象为一个函数, 如(\ref{eq2.1})所示,  $\vec{\alpha}$代表皮肤三参数组合, $\vec{A}_{BPS}$代表某一组分中的BPS含量在给定固定时间节点上的数值, 相应地, $n$是时间节点组的节点数量,
\begin{equation}\label{eq2.1}
f:(\mathbb{R}^3)^{+} \to (\mathbb{R}^n)^{+},\quad \vec{\alpha}\mapsto \vec{A}_{BPS}.
\end{equation}
\noindent 本章内介绍的参数反演神经网络的功能就是拟合(\ref{eq2.1})的反函数, 输入固定节点处血浆与尿液内BPS或BPS-g的含量数值构成的向量$(A(t_1),A(t_2),\dots,A(t_n))$, 网络模型会输出一组近似的与输入对应的皮肤三参数组合
$\vec{\alpha^*}$.

数据集由特征(feature)与标签(label)构成, 特征是神经网络模型的输入, 标签是网络模型输出的对照物, 网络模型的输出是对标签的拟合. 一条数据包含一条特征和一条标签, 二者之间是绑定关系. 
在本章的参数反演神经网络模型的数据集中, 一条特征是一个含有$n$个元素的一维数组, 实际含义是PBPK模型输出的$A_{plasma}(t)$, $A_{urinebps}(t)$, $A_{urinebpsg}(t)$在固定时间节点
$\{t^{plasma}_{i}\}_{1 \leq i \leq n_1}$, $\{t^{urine}_{i}\}_{1 \leq i \leq n_2}$上的取样值. 一条标签是一个含有$3$个元素的一维数组, 实际含义是与代表PBPK模型输出的特征对应的皮肤三参数组合$\vec{\alpha} = (\alpha_1,\alpha_2,\alpha_3)$. 
整个数据集由大量数据组成, 设置数据条数为$N$, 则整个特征集是一个形状为$N \times n$的二维数组, 通常记为$X$; 与之对应的标签集是一个形状为$N \times 3$的二维数组, 通常记为$y$. 

\subsection{标签集的构建}
\label{3.2.1}
标签集, 一个$N \times 3$的二维数组, 由$N$条皮肤三参数组合组成. 由于$DSC$, $Pfo$ ,$u_1$这三个参数的数量级较小, 为了更方便地表示其数值, 将标签$\vec{\alpha}$设置如下, 在原参数数值前乘以一个系数, 使得
调整后的参数数量级处在$10^0$或$10^1$:
$$
  \alpha_1 = DSC \times 10^9, \quad
  \alpha_2 = Pfo \times 10^5, \quad
  \alpha_3 = u_1 \times 10^5.
$$
\noindent 本文使用了两种方式得到大量不同的皮肤三参数组合$\vec{\alpha}$数据, 分别是依概率分布随机取样以及稀疏网格法(Sparse Grids). 之后将两种方法得到的数据合并在一起, 构成本章神经网络使用的标签集.
以下是两种构建方法的具体介绍.

\subsubsection*{截断正态分布取样}
Hu等人\cite{11}提出了该种取样方法, 并提供了皮肤三参数$\alpha_i$的平均值$mean_i$, 并设定每个参数的变异系数$CV_i = 0.3$, 通过公式$std = CV\times mean$可得到三个参数的标准差$std_i$. 分别建立三个参数的截断正态分布, 分布的平均值为
$mean_i$, 标准值为$std_i$, 左截断点为$lb_i = mean_i - 1.96\times std_i$ , 右截断点为$ub_i = mean_i + 1.96\times std_i$. 确定截断正态分布后, 使用Python第三方库函数scipy.stats.truncnorm()根据三种概率分布
对三个参数进行独立的采样, 采样$\alpha_1$共$32$个, $\alpha_2$共$30$个, $\alpha_3$共$30$个. 接下来取它们的笛卡尔积, 得到$32 \times 30 \times 30 = 28,800$组皮肤三参数组合$\vec{\alpha}$. 

\subsubsection*{稀疏网格法}

稀疏网格法\cite{15,18}是一种可用于在高维参数空间取样的高效方法. 以$m$维参数空间下的同维度等距的网格为例, 有如下的稀疏网格生成迭代步骤:

\begin{enumerate}
  \item 设置复杂度$k\in \mathbb{N}^+ $, 设置参数取样的平均值或中心点$\bar{x} = (\bar{x}_1 ,\dots, \bar{x}_m)$以及每个维度取样的上下界$\{u_i,l_i\}_{1 \leq i \leq m}$(应满足$\frac{u_i+l_i}{2}=\bar{x}_i$).
  第$i$个维度的网络格点间距$\Delta x_i = (u_i - l_i)\times 2^{-k}$. 如此, 便得到了一个$m$维空间上含有$(2^k+1)^m$个格点的网格, 称该网格为\textit{密网格}.\\
  设置迭代步$p$, 初始$p = 1$.初始状态下稀疏网格只有
  中心点$\bar{x}$一个点, 设置$\bar{x}$为\textit{起点}$x_{start}$, 加入至\textit{起点集}$S$.
  \item 若$2^{k-p}-1 < 1$, 则取样结束. 否则, 向下执行.
  \item $\forall x_{start} \in \textit{起点集}S$, 从该点出发, 向每个维度的正负方向共$2\times m$ 个方向上分别以$2^{(p-1)} \cdot \Delta x_i$为步长连续不间断地在密网格上取$2^{k-p}-1$个格点加入到稀疏网格中.
  例如, 在第$i$个维度的正方向上取
  $$
  \{( x_{start}^1,\dots,x_{start}^{i-1},x_{start}^i+j\cdot 2^{(p-1)} \cdot  \Delta x_i, x_{start}^{i+1},\dots,x_{start}^m)\}_{1 \leq j \leq 2^{k-p}-1}.
  $$
  当迭代步数$p \geq 2$时, 若密网格在$x_{start}$的某方向上(不妨设为第$q$个维度)有与$x_{start}$距离小于等于$2^{(p-1)} \cdot \Delta x_q$
  的点已被加入至稀疏网格中, 则不在$x_{start}$的该方向上取点, 并称该方向为$x_{start}$的\textit{未取样方向}. 在该步骤中, 会有被重复放入稀疏网格中的密网格上的点, 在稀疏网格中视作同一元素.
  
  \item 
  当$p = 1$时, $\forall 1 \leq i \leq m$ , 将中心点$\bar{x}$在第$i$维度正负两个方向上与之距离为$(u_i - l_i)\times 2^{-(p+1)}$的两个点加入至起点集中$S$, 共有$2\times m\times 2^{m\times (p-1)}$个新的起点被加入至起点集$S$中, 删去起点集中除了新起点外的起点.\\
  当$p \geq 2$时, $\forall x_{start} \in \textit{起点集}S$, 从该点出发, 找到并记录稀疏网格在$x_{start}$除未取样方向的方向上与之距离为$(u_i - l_i)\times 2^{-p}$的点, 加入至\textit{分形中心点集}$M$.
  在此过程中, 会有被重复放入$M$的密网格上的点, 在$M$中视作同一元素. 接下来, $\forall x_{middle} \in \textit{分形中心点集}M$, 从该点出发, 找到并记录
  稀疏网格在$x_{middle}$在每个维度正负两个方向共$2\times m$ 个方向上与之距离为$(u_i - l_i)\times 2^{-(p+1)}$的点, 加入至起点集$S$中.
  共有$2\times m\times 2^{m\times (p-1)}$个新的起点被加入至起点集$S$中, 删去起点集中除了新起点外的起点. 

  \item $p = p + 1$, 并跳转至步骤2.
  \end{enumerate}

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.32\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode2_1.pgf}}
    \caption{$k=2$}
  \end{subfigure}
  \begin{subfigure}{0.32\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode2_2.pgf}}
    \caption{$k=3$}
  \end{subfigure}
  \begin{subfigure}{0.32\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode2_3.pgf}}
    \caption{$k=5$}
  \end{subfigure}

  \caption{不同复杂度$k$下的二维稀疏网格}
  \label{稀疏网格}
\end{figure}

该部分标签集的构造使用了复杂度$k=9$的三维稀疏网格法, 其中中心点为$(mean1,mean2,mean3)$, $u_1-l_1 = 14,\quad u_2-l_2 = 10,\quad u_3-l_3 = 9$, 这些数值的设定参考了截断正态分布取样法.
通过稀疏网格法共得到了18943条皮肤三参数组数据. 两种方法得到的标签集拼接起来共47743条数据, 整个标签集的形状为$47743\times 3$.

\subsection{特征集的构建}
\label{3.2.2}
一条特征和一条标签互相唯一对应, 本章中的参数反演神经网络模型使用的特征集也有47743条.对于标签集矩阵的每一行的皮肤三参数组, 将其代入至PBPK模型的求解模型, 得到血浆中BPS的含量$A_{plasma}(t)$, 尿液中BPS和BPS-g的累计含量$A_{urinebps}(t)$, $A_{urinebpsg}(t)$关于时间变化的曲线.
为了适配人体实验中的真实采样数据, 模拟真实采样情景, 需要对曲线做采样. 以下介绍了两种特征集的构造, 将分别用于训练两种不同的参数反演神经网络模型.

\subsubsection*{血药含量采样28点\&尿药含量采样15点}
此小节的采样时间点设置参考了前人人体实验的设定\cite{11,13}, 且结合了曲线的特性.
如图\ref{曲线}所示,曲线的总时间轴是$0\thicksim 75h$, 相较于其他时间段, $A_{plasma}(t)$在$0\thicksim 10h$的变化十分强烈, 需要在该时间段内取样额外多的时间点, 以更好地捕捉到曲线的特征.



\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode3_1.pgf}}
    \caption{$A_{plasma}(t)$}
    \label{曲线a}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode3_2.pgf}}
    \caption{$A_{urinebps}(t)$与$A_{urinebpsg}(t)$}
    \label{曲线b}
  \end{subfigure}


  \caption{$\vec{\alpha}=(14,6.39,6)$时PBPK模型输出的部分曲线图像}
  \label{曲线}
\end{figure}

\noindent 一条血药含量曲线上共采样28个时间点(单位: $h$):

\hspace{0.8cm} $( 0.5 , 1 ,  1.5  ,   2,  2.5  ,3,   3.5 , 4,   4.5,  5,   6,   7,   8,   9,  10,  11,  12,  13,  14,  15,  18,  24,  30,  36,  42,  50,  60,  72 ).$

\noindent 两条尿药含量曲线上分别采样相同的15个时间点(单位: $h$):

\hspace{0.8cm} $( 1,  3,  5,  7,  9, 11, 13, 15, 24, 30, 36,42, 50, 60, 72).$

图\ref{曲线与采样点}展示了三条含量曲线的采样点的位置. 一条标签对应的三条曲线在固定时间节点处共采样了58个化学品含量数据, 一条特征即为含有58个元素的一维数组, 对应的标签为PBPK模型的输入皮肤三参数组, 整个特征集为形状是$47743\times 58$的二维数组.
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode4_1.pgf}}
    \caption{$A_{plasma}(t)$与28点采样点}
    \label{曲线与采样点a}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode4_2.pgf}}
    \caption{$A_{urinebps}(t)$,$A_{urinebpsg}(t)$与15点采样点}
    \label{曲线与采样点b}
  \end{subfigure}


  \caption{$\vec{\alpha}=(14,6.39,6)$时PBPK模型输出的部分曲线与采样点的图像A}
  \label{曲线与采样点}
\end{figure}

\subsubsection*{血药含量采样5点\&尿药含量采样5点}

该部分特征集的构建欲探究减少采样点的可行性. 如图\ref{曲线a}所示, $A_{plasma}(t)$的图像有两个极大值和一个极小值, 第一个极大值也是最大值$MAX_{plasma}$. 最大值点出现在曲线变化幅度大的时段, 三个极值点都处在非平缓的时间段. 
对于标签集中每一条皮肤三参数对应的PBPK输出中的$A_{plasma}(t)$, 将其图像中的三个极值点设置为采样点, 记录这三个点的位置. 另外, 为了捕捉到更多曲线变化剧烈处的特征信息, 将满足$\underset{\scriptsize 0<t< \textit{极小值点}}{argmin}|A_{plasma}(t) - 0.5\cdot MAX_{plasma}| $
的两个半衰期点也设置为采样点, 记录这两个点的位置. 将标签集对应的所有血药含量曲线的五个采样点都绘制在同一图像中, 如图\ref{血浆五点}所示:

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.45]{./figs/p3_1.png}
  \caption{所有$A_{plasma}(t)$曲线的五个采样点}
  \label{血浆五点}
\end{figure}

\noindent 可以看到最大值点与两个半衰期点的位置几乎是固定的, 极小值点与第二极大值点几乎都在$30h$前出现. 对于五种采样点, 计算
图\ref{血浆五点}中每种采样点位置的平均值, 将得到的五个平均值作为全局的固定采样点, 它们分别为$(0.49,2.165, 3.005 ,8.22,18.255)$.

对于$A_{urinebps}(t)$与$A_{urinebpsg}(t)$, 由于它们是浓度累计曲线(如图\ref{曲线b}), 难以像血浆BPS含量曲线一样从曲线形状来确定较少的采样点. 由于$A_{urinebps}(t)$是
数值求解的结果, 本质上是一个离散的数组, 故可以对其做一阶差分, 得到某个$A_{urinebps}(t)$的一阶差分曲线如图\ref{尿液差分}所示:
\begin{figure}[H]
  \centering
  \includegraphics[scale=0.45]{./figs/p4_1.png}
  \caption{$\vec{\alpha}=(14,6.39,6)$时$A_{urinebps}(t)$的一阶差分曲线}
  \label{尿液差分}
\end{figure}

可以看到$A_{urinebps}(t)$的一阶差分曲线有类似于$A_{plasma}(t)$曲线的图像模式, 利用得到血浆曲线的五个全局固定采样点的方式可以得到
两条尿液化学品累计含量曲线的五个全局固定采样点, 它们分别为$(0.505,2.165, 3.04 ,8.265,13.305)$. 图\ref{曲线与采样点5}展示了三条含量曲线的五个固定采样点的位置.

\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode5_1.pgf}}
    \caption{$A_{plasma}(t)$与5点采样点}
    \label{曲线与采样点5a}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode5_2.pgf}}
    \caption{$A_{urinebps}(t)$,$A_{urinebpsg}(t)$与5点采样点}
    \label{曲线与采样点5b}
  \end{subfigure}


  \caption{$\vec{\alpha}=(14,6.39,6)$时PBPK模型输出的部分曲线与采样点的图像B}
  \label{曲线与采样点5}
\end{figure}

确定了血浆曲线与尿液曲线的全局固定采样时间点后, 便可以确定特征集. 
一条标签对应的三条曲线在固定时间节点处共采样了15个化学品含量数据, 一条特征即为含有15个元素的一维数组, 对应的标签为PBPK模型的输入皮肤三参数组, 整个特征集为形状是$47743\times 15$的二维数组.


\section{参数反演神经网络模型的架构}

为了使网络模型在多全连接层的情况下的性能退化问题, 本文的神经网络模型使用了残差连接的方法, 具体实现手段为引入了一个\textit{残差网络模块}.
该模块由六层构成, 第一层和第四层为全连接层, 第二层和第五层为标准化层, 第三层和第六层为激活函数层, 使用的激活函数为$Relu(\,)$. 图片\ref{残差网络模块}展示了该模块的架构, 其中每一层的输入和输出的
二维数组的形状都是$batchsize \times hiddensize$, 其中$batchsize$是一个批次的数据条数, $hiddensize$是可自定义的隐藏层神经元数量. 
\begin{figure}[H]
  \centering
  \includegraphics[scale=0.45]{./figs/p5_1.png}
  \caption{残差网络模块的架构}
  \label{残差网络模块}
\end{figure}
全连接层的是神经网络领域中最常用的一种网络结构, 设输入全连接层的二维数组为$X$,形状为$batchsize\times size1$ 则该层输出的二维数组$Y$(形状为$batchsize\times size2$)有公式:
$$
Y = (W\cdot X^{T} + b)^{T}.
$$
其中$W$被称作``权重'', 形状为$size2\times size1$; 一维数组$b$被称作``偏置量'', 形状为$size2\times 1$, $b$会与$W\cdot X^{T}$的每一列分别相加. 

层标准化是一种不依赖于数据条数的标准化方法, 当$batchsize\times size$的二维数组$X$作为输出传入该结构时, 层标准化会对数据中的每一条特征$x^j$($1\leq j \leq batchsize$)单独进行标准化操作:
$$
\mu^j = \frac{1}{size}\cdot \sum_{i = 1}^{size}  x_i^j \,\,, \quad  \sigma^j = \sqrt{\frac{1}{size}\cdot \sum_{i = 1}^{size}(x_i^j-\mu)^2  } \,\,, \quad x^j = \frac{x^j - \mu^j}{\sigma^j + \epsilon} \,.
$$
\noindent 其中$\epsilon$用于维持数值稳定的数量级很小的数字. 对输入矩阵的每条特征单独进行标准化后, 还要再对标准化后的每条特征$x^j$分别做一次仿射变换:
$$
x^j = g^j \cdot x^j + b^j  \,.
$$
\noindent 其中的$(g^j, b^j)$相对于层标准化作为网络结构所具有的系数, 网络的损失函数关于它们的梯度信息将会在反向传播中得到计算, 并同网络的其他系数一起得到更新, 即仿射变换的系数将会在神经网络中得到学习. 对标准化后的数据施加仿射变换的做法
增加了数据数值的灵活性, 使其与后续的处理更加匹配, 同时增加了数值稳定性, 进一步规避了梯度消失或梯度爆炸的情况.


该模块的最终的输出结果是第六层的输出与第一层的输入的和, 相对于第六层输出的是期望输出和真实输出之间的残差, 这样的设定使得网络可以学习到残差映射, 同时保留了原始的输入并将其直接传输到了该模块的输出\cite{16,17}. 残差网络中的
跳跃连接能够缓解深层网络下的性能退化与优化困难问题\cite{17}. 标准化层使用了层标准化手段(layer-normlization), 使得输入数据在输出该层时能够具有零均值与单位方差的性质, 同时该标准化手段并不依赖于$batchsize$的大小\cite{19}.
层标准化有效解决了深度网络情况下梯度爆炸与梯度消失的问题. 激活层的$Relu(\,)$的作用是对输入该层的数据逐元素取其正部. 它能够提高计算速率, 使得前向与反向传播的速度更快, 且保留正部而不是压缩数值的激活方式能够缓解梯度消失的问题\cite{20}.

整个神经网络的架构串联拼接了$hidden\_nums$个残差网络模块, 并在串联组前后都添加了一层全连接网络, 输入端还额外添加了一个激活函数$Relu(\,)$层. 图片\ref{网络结构}展示了该模块的架构.

\begin{figure}[H]
  \centering
  \includegraphics[scale=0.6]{./figs/p5_2.png}
  \caption{本文神经网络模型的结构}
  \label{网络结构}
\end{figure}

\noindent 网络的输入数据形状为$batchsize \times inputsize$, 第一层全连接层的输出数据形状为$batchsize \times hiddensize$, 后续层的输入输出至倒数第一层的输入数据的形状都是$batchsize \times hiddensize$, 最后一层全连接层的输出数据形状为$batchsize \times outputsize$.

对于该章的参数反演神经网络, 其网络模型架构的参数如下:
$$
outputsize = 3, \quad hiddensize = 30, \quad hidden\_nums = 3.
$$
\noindent 整个网络的输出即为反演后的皮肤三参数组, 中间隐藏层的神经元数量为30个, 残差网络模块的串联数量为3个. 同时, 根据特征集的不同, 本节共有两个参数反演神经网络, 两个网络模型的架构只在$inputsize$的取值上有差异. ``血药含量采样28点\&尿药含量采样15点''特征集对应的$inputsize=58$, ``血药含量采样5点\&尿药含量采样5点''特征集对应的$inputsize=15$.

\section{参数反演神经网络模型的训练}
\label{3.4}

本章中的两个参数反演神经网络模型的训练部分是相同的, 故不作区分. 
\subsection{数据集的预处理,划分与训练流程}
在训练开始前, 将特征集与标签集分别进行标准化处理, 使作为数据集的矩阵的每一列具有零均值, 单位标准差的性质. 数据集的标准化处理可以增强模型的稳定性, 保持梯度的一致性与稳健性, 减少梯度消失或爆炸的风险\cite{21}. 同时, 标准化处理可以减小数据条目之间的数值差距, 使不同尺度的数据具有类似的分布特性, 令网络训练更专注于反演模型拟合这一主要任务, 而不是专注于输入数据的数值本身. 因而, 在处理未见到的
数据时, 网络也不会因为陌生的数值而给出不佳的表现, 故标准化处理还可以提升网络的泛化能力\cite{22}.

数据集预处理后, 根据训练需求被随机划分为训练集, 验证集, 测试集三个部分, 三个部分的条目比例为$8:1:1$, 特征集与标签集被同步地划分, 划分后依然保持条目一一对应的关系. 

在一轮训练中, 整个训练集被分为若干小批量数据, 在一轮训练内, 每个小批量数据都会前后被代入至未完善模型中,
计算损失函数关于网络模型内各系数的梯度信息, 并根据梯度信息使用优化算法来更新网络模型中的系数\cite{23}. 
利用所有训练集小批量完成了一轮网络模型系数更新后, 将整个验证集分批次地代入至当前的网络模型中, 
观测其对应的损失函数\cite{23}. 在验证期间, 引入早停技术(early stopping)中的耐心值设定: 记录当前有着验证集最优损失的训练轮次, 若接下来连续$patience = 8$个训练轮内验证集上的损失函数没有小于验证集最优损失, 则停止训练并储存当前有着最优验证集损失的网络模型的全部系数, 否则继续下一轮的训练(网络模型系数更新)\cite{23}. 训练结束后, 调用已储存的网络模型, 将验证集内的数据代入至网络模型计算损失函数, 并以此为评价
网络模型优劣的指标之一.

\subsection{损失函数与优化器}

损失函数的设置利用了对偶学习(Dual Learning)的手段, 具体为$\|\vec{\alpha}-\vec{\alpha^*} \|^2$与$\|f(\vec{\alpha})-\tilde{f}(\vec{\alpha^*}) \|^2$的线性组合. 其中
$\vec{\alpha}$为标签皮肤三参数组, $\vec{\alpha^*}$为网络模型输出的反演得到的皮肤三参数组,$f$为公式(\ref{eq2.1})中的PBPK模型的求解模型, $\tilde{f}$为拟合了PBPK模型正向求解的神经网络模型. 由于共有三种化学品含量曲线$A_{plasma}(t), A_{urinebps}(t), A_{urinebpsg}(t)$, 一个参数反演神经网络共对应三个正向拟合神经网络. 每个正向拟合神经网络的输入数据为参数反演网络输出的皮肤三参数组$\vec{\alpha}^*$, 输出的是拟合后的对应于这组皮肤三参数组的某种化学品浓度曲线的采样点, 在下一节会详细介绍对偶学习与PBPK模型拟合神经网络模型的内容. 
以``血药含量采样28点\&尿药含量采样15点''对应的参数反演网络为例, 其损失函数中的$\|f(\vec{\alpha})-\tilde{f}(\vec{\alpha^*}) \|^2$具体形式为

\noindent $(MSE_{plasma}+MSE_{urinebps}+MSE_{urinebpsg})\times \frac{1}{3}$,
其中三个$MSE$分别代表特征集中血药含量曲线采样点与正向拟合神经网络输出的血药含量曲线采样点之间的均方误差, 特征集中尿液BPS累计含量曲线采样点与正向拟合神经网络输出的尿液BPS累计含量曲线采样点之间的均方误差以及特征集中尿液BPS-g累计含量曲线采样点与正向拟合神经网络输出的尿液BPS-g累计含量曲线采样点之间的均方误差.

优化器使用了torch.optim中的Adam(\,)函数, 即Adam算法. 
Adam优化算法中的下降步长需要使用当前梯度信息的一阶矩估计(梯度信息的指数平滑)与二阶矩估计(梯度信息的逐项平方的指数平滑)\cite{24}. 矩估计在经过
修正后(迭代步较小时的矩估计将会被放大), 代入至系数更新公式$\Delta \theta   = -\epsilon \frac{\hat{s}}{\sqrt{\hat{r}} +\delta } $, 其中$\hat{s}$为修正后的一阶矩估计, $\hat{t}$
为修正后的二阶矩估计, $\delta$为用于数值稳定的小常数\cite{24}. Adam算法是一种高效的自适应学习率优化算法, 它可以利用迭代内的历史梯度信息来调整网络模型内每个系数的学习率, 使得模型系数的更新
过程更加灵活与快速\cite{24}. 同时该算法不易陷入局部最优解, 可以很好地处理非凸问题\cite{25}.





\section{对偶学习与PBPK模型拟合神经网络模型}

\subsection{对偶学习的引入背景}
在神经网络的训练过程中, 需要设置损失函数, 并以减少损失函数的数值为目标来迭代网络模型中的系数. 对于参数反演的问题, 见公式(\ref{eq2.1}), 损失函数应设置为$\|f(\vec{\alpha})-f(\vec{\alpha^*}) \|^2 $, 即原本的皮肤三参数组代入至PBPK模型求解得到的含量曲线采样点与网络模型输出的反演皮肤三参数组代入至PBPK模型求解得到的含量曲线采样点之间的平均平方误差. 但由于计算资源问题, 较为庞大的PBPK模型的求解模型难以植入神经网络模型并在反向传播中正常运作. 故损失函数设置为 $\|\vec{\alpha}-\vec{\alpha^*} \|^2 $, 即原本的皮肤三参数组与网络模型输出的反演皮肤三参数组之间的平均平方误差.
但这样的损失函数在训练过程中缺乏对神经网络模型的引导, 此处引入对偶学习, 训练一个能够拟合函数$f$的正向神经网络模型$\tilde{f}$, 与参数反演神经网络形成对偶关系. 同时, 将
$\|f(\vec{\alpha})-\tilde{f}(\vec{\alpha^*}) \|^2 $作为损失函数内的一个正则化项, 与$\|\vec{\alpha}-\vec{\alpha^*} \|^2 $一项共同引导参数反演神经网络去学习$\vec{\alpha}$
与$f(\vec{\alpha})$之间的映射关系. 其中$f(\vec{\alpha})$已知, 即为参数反演神经网络的特征集, $\tilde{f}(\vec{\alpha^*})$是参数反演神经网络输出的皮肤三参数组代入至正向拟合神经网络输出的结果, 含义为
拟合得到的化学品含量曲线上的采样点.

\subsection{正向拟合神经网络模型的数据集结构与构建}
\label{3.5.2}
由于与参数反演神经网络是对偶关系, 本章中的正向拟合神经网络也使用固定时间采样节点来构建数据集, 同时也沿用参数反演神经网络数据集内的数据. 由于采样时间节点的不同, 本章共有两种参数反演神经网络, 相应地也有两类正向拟合神经网络.
并且, 为了更好地拟合PBPK模型输出的三种含量曲线$(A_{plasma}(t), A_{urinebps}(t), A_{urinebpsg}(t))$, 对于每种时间采样点, 本节将分别训练三个正向拟合神经网络, 分别拟合血浆BPS含量曲线的采样点,
尿液BPS累计含量曲线的采样点以及尿液BPS-g累计含量曲线的采样点. 故正向拟合神经网络的特征集为皮肤三参数组$\vec{\alpha}$的集合, 对应的标签集为$\vec{\alpha}$代入至PBPK模型求解得到的某种含量曲线的采样点 $(A(t_1),A(t_2),\dots,A(t_n))$的集合.

对于任意一种时间采样点, 需要训练的三个正向拟合神经网络的特征集都与相同时间采样点情形下的参数反演神经网络的标签集相同, 其形状为$47743 \times 3$.
三个正向拟合神经网络的标签集是相同时间采样点情形下的参数反演神经网络的特征集的切片. 例如, 在血药含量曲线采样28点的情况下, 用于拟合$A_{plasma}(t)$曲线的采样点的正向拟合神经网络的标签集是参数反演神经网络的特征集的前28列, 形状即为$47743 \times 28$.

\subsection{正向拟合神经网络模型的网络结构与训练}

本节共有六个正向拟合神经网络, 对应两种时间采样节点与三种含量曲线$(2\times 3 = 6)$. 对于每个正向拟合神经网络, 其架构与图\ref{网络结构}所呈现的相同, 架构中的参数相应地设置为:
$$
inputsize = 3, \quad hiddensize = 30, \quad hidden\_nums = 3.
$$
\noindent 整个网络的输入即为包含47743条皮肤三参数的特征集, 中间隐藏层的神经元数量为30个, 残差网络模块的串联数量为3个. 同时, 根据标签集的不同, 本小节内的六个网络模型的架构只在$outputsize$的取值上有差异. 例如, 用于拟合``血药含量采样28点''的正向拟合神经网络对应的$outputsize=28$.

正向拟合神经网络模型训练时的损失函数为网络输出与对应标签之间的均方误差, 余下的训练方法与流程与\ref{3.4}节中参数反演神经网络模型的训练完全相同, 不再介绍.

\subsection{正向拟合神经网络模型的效果展示}
本小节将展示正向拟合神经网络模型在测试集上的泛化效果, 评价指标为标签与输出之间的平均平方误差$MSE$, 平均相对误差$MRE$与决定系数$R^2$ $\,$($R^2 \in (0,1]$, 决定系数越靠近1, 说明模型的拟合效果越好, 评价指标将在\ref{3.6}节中详细说明).
表格\ref{tab4.0}展示了本节六个正向拟合神经网络模型在测试集上得到的三种评价指标. 可以看出, 六个神经网络模型的泛化效果都很好, 每个网络对应的决定系数都在99\%以上, 后五个网络对应的$MRE$都在1\%以内, 其中第一个网络的
$MRE$偏大的原因是, 其标签集内数据的数量级十分小, 故与对应输出的相对误差较大.
\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{c*{3}{c}}
    \hline
    \textit{正向网络对应的标签集信息} &$MSE$ & $MRE$ & $R^2$\\
    \hline
    \textit{血浆BPS采样28点} & $3.35\times 10^{-9}$     &  12.51\%     &  99.72\%  \\ 
    \textit{尿液BPS采样15点} &  $8.69\times 10^{-7}$     &  0.59\%     & 99.97\%  \\ 
    \textit{尿液BPS-g采样15点} &  $1.49\times 10^{-5}$     &  0.58\%     & 99.97\%  \\ 

    \textit{血浆BPS采样5点} & $9.59\times 10^{-10}$     &  0.96\%     &  99.96\%  \\ 
    \textit{尿液BPS采样5点} &  $9.16\times 10^{-8}$     &  0.42\%     & 99.98\%  \\ 
    \textit{尿液BPS-g采样5点} &  $2.39\times 10^{-6}$     &  0.50\%     & 99.97\%  \\ 
    \hline
  \end{tabular}
  \caption{\label{tab4.0}六个正向拟合神经网络在测试集上的评价指标} 
\end{table}

图\ref{正向可视化1}展示了本节六个正向拟合神经网络中的两种网络的拟合效果, 曲线部分为测试集内某皮肤三参数组代入至PBPK模型求解得到的BPS含量曲线, 散点部分为正向拟合神经网络输出的固定时间节点处的BPS含量信息. 通过
可视化可发现正向拟合神经网络对PBPK正向模型的拟合效果较好.
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode7_1.pgf}}
    \caption{\textit{血浆BPS采样28点对应的网络}}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode7_2.pgf}}
    \caption{\textit{尿液BPS采样15点}}
  \end{subfigure}
  \caption{$\vec{\alpha}=(10,5.4,8.45)$时两种正向拟合神经网络的输出可视化}
  \label{正向可视化1}
\end{figure}

\section{参数反演神经网络模型的效果展示}
\label{3.6}
评价神经网络模型需要使用网络训练过程中未输入过的``陌生''数据, 以此来检查网络模型的泛化能力. 原始数据集划分出的测试集即是可用于测试网络模型的陌生数据.
\subsection*{评价指标说明}

参数反演网络的输入为特征集内的58个元素或15个元素的含量曲线采样点, 输出为反演得到的皮肤三参数组. 
为了评价网络模型的优劣, 需要将网络模型未见过的陌生数据输入至网络中, 并观察输出与陌生数据的标签之间的差异.
陌生数据(测试数据)也由特征和标签组成, 网络的前两个评价指标就是测试数据标签中的皮肤三参数组与网络输出的皮肤三参数组之间的均方误差$MSE_{\vec{\alpha}}$
与平均相对误差$MRE_{\vec{\alpha}}$.
陌生数据的特征代表了三种化学品含量曲线上的58个采样点或15个采样点, 记为\textit{特征集化学品含量信息}. 为了与之对应, 将网络输出的皮肤三参数组代入至PBPK模型的求解模型中, 在得到的三种
化学品含量曲线上在固定时间节点上采样, 得到58个或15个元素的化学品含量信息, 记为\textit{网络输出的化学品含量信息}.
将特征集化学品含量信息与网络输出的化学品含量信息之间的均方误差$MSE_{concentration}$与平均相对误差$MRE_{concentration}$作为另外两个评价指标, 分别简记为$MSE_{C}$与$MRE_{C}$.
另外, 对于单条特征集化学品含量信息与对应的网络输出的化学品含量信息, 计算它们之间的决定系数\cite{26}:
$$
R^2 = 1 - \frac{\sum_{i=1}^{n} (y_i - \hat{y}_i)^2}{\sum_{i=1}^{n} (\hat{y}_i - \bar{y})^2 }.
$$
其中$n$是一条化学品含量信息的元素数, $y_i$是一条特征集化学品含量信息的第$i$个元素, $\bar{y}$是一条特征集化学品含量信息的平均值, $\hat{y}_i$是一条网络输出的化学品含量信息的第$i$个元素.
$R^2$原本被用于度量线性回归模型的预测数据与真实数据之间的差距\cite{26}, 但也可应用于神经网络模型的预测数据与真实数据的差距衡量, 孙茜童等人和李爱民等人\cite{27,28}在评价参数反演功能的神经网络时都使用了$R^2$
作为主要评价指标. $R^2 \in (0,1]$, 决定系数越靠近1, 说明模型的拟合效果越好.

本文共使用五种评价指标: $MSE_{\vec{\alpha}}$, $MRE_{\vec{\alpha}}$, $MSE_{C}$, $MRE_{C}$, $R^2$.

\subsection*{扩充测试集}
由于测试集和神经网络训练时所使用的数据集是同源的, 欲考察神经网络在测试集之外的表现情况, 设定\textit{扩充测试集}并将其应用于参数反演神经网络模型. 
扩充测试集的构建与\ref{3.2}节的数据集构建类似, 首先利用皮肤三参数组内各参数的截断正态分布分别对三个参数进行独立的采样, 再取三个参数采样集合的笛卡尔积, 得到标签集.
但为了测试网络模型的在更广的参数空间内的泛化能力, 对此处的截断正态分布的标准差和左右截断点都做出了改动, 使得依更改后的截断正态分布采样能更大概率地得到原数据集中出现频率较低的数值区间内的参数值.
原概率分布的参数为:
\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{|l*{3}{l}|}

    $mean_1 = 17.28$ &$std_1 = 5.184$ &$lb_1 = 7.12$ &$ub_1 =27.44$  \\ 
  
    $mean_2 = 6.39$  &$std_2 = 1.917$ &$lb_2 = 2.63$ &$ ub_2 =10.1$  \\ 
  
    $mean_3 = 5.7$ &$std_3 = 1.71$  &$lb_3 = 2.35$ &$ub_3 =9.05$ \\ 

  \end{tabular}
\end{table}  

\noindent 更改后的概率分布的参数如下表所示, 其中平均值$mean_i$未变, 三个分布的标准差$std_i$都增大了, 后两个参数增大的幅度额外大, 三个参数的左右截断点之间的距离增大了.

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{|l*{3}{l}|}

    $mean_1 = 17.28$ &$std_1 = 8$ &$lb_1 = 5.78$ &$ub_1 =28.78$  \\ 
  
    $mean_2 = 6.39$  &$std_2 = 5$ &$lb_2 = 1.39$ &$ ub_2 =12.89$  \\ 
  
    $mean_3 = 5.7$ &$std_3 = 5$  &$lb_3 = 0.7$ &$ub_3 =11.7$ \\ 

  \end{tabular}
\end{table}  


\noindent 对于每个参数, 依其更改后的截断正态分布采样$10$次, 取笛卡尔积后得到$10\times10\times10 = 1000$组皮肤三参数组, 这是扩充测试集的标签集. 接下来将标签集中的
皮肤三参数组代入至PBPK模型求解, 得到的三种化学品含量曲线$A_{plasma}(t), A_{urinebps}(t), A_{urinebpsg}(t)$按照
\ref{3.2}节中的两种固定时间采样点分别采样为两个特征集.

\subsection*{参数反演神经网络A:特征集每行包含58个含量信息}
\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{l*{5}{c}}
    \hline
    \textit{测试集类型} &$MSE_{\vec{\alpha}}$&$MRE_{\vec{\alpha}}$ & $MSE_{C}$& $MRE_{C}$& $R^2$\\
    \hline
    \textit{原始测试集} &  0.26   &   2.30\%     &   $5.54\times 10^{-6}$     &  13.62\%     &  99.95\%  \\ 
    \textit{扩充测试集} &  0.76   &   2.20\%     &   $2.51\times 10^{-4}$     &  39.45\%     &  98.38\%  \\ 
    \hline
  \end{tabular}
  \caption{\label{tab4.1}参数反演神经网络A在测试集上的评价指标} 
\end{table}  
如表\ref{tab4.1}所示, 使用了58个含量信息的特征集的参数反演神经网络在原始测试集和数值较为极端的扩充测试集上都得到了很好的效果, 其中$R^2$都处在$98\%$以上, $MRE_{\vec{\alpha}}$都在$2.5\%$以内.
$MRE_{C}$的数值较大, 原因可能是在计算化学品含量信息之间的相对误差时, 某些含量信息的数值极小(数量级为$10^{-9}$), 细微的绝对数值差别都会导致很大的相对误差. 
总的来说, 参数反演神经网络在原始测试集上的效果更好, 因为原始测试集虽然为陌生数据, 但与训练所用数据同源, 参数分布情况相近. 但在参数分布较极端的扩充测试集上, 网络模型A也显示出了不错的泛化效果.
图\ref{反演A}展示了$\vec{\alpha}=16.91,10.14,7.95$时参数反演神经网络A的效果, 其中的曲线为特征集化学品含量信息对应的未采样前的完整曲线, 散点为网络输出的化学品含量信息.
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode6_1.pgf}}
    \label{反演A1}
    \caption{$A_{plasma}(t)$}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode6_2.pgf}}
    \label{反演A2}
    \caption{$A_{urinebps}(t)$与$A_{urinebpsg}(t)$}
  \end{subfigure}
  \caption{$\vec{\alpha}=(16.91,10.14,7.95)$时参数反演神经网络A的输出可视化}
  \label{反演A}
\end{figure}

\subsection*{参数反演神经网络B:特征集每行包含15个含量信息}

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{l*{5}{c}}
    \hline
    \textit{测试集类型} &$MSE_{\vec{\alpha}}$&$MRE_{\vec{\alpha}}$ & $MSE_{C}$& $MRE_{C}$& $R^2$\\
    \hline
    \textit{原始测试集} &  0.17  &   1.82\%     &   $3.78\times 10^{-7}$     &  1.39\%     &  99.98\%  \\ 
    \textit{扩充测试集} &  0.95  &   3.50\%     &   $1.52\times 10^{-6}$     &  12.90\%     & 93.91\%  \\ 
    \hline
  \end{tabular}
  \caption{\label{tab4.2}参数反演神经网络B在测试集上的评价指标} 
\end{table}  

如表\ref{tab4.2}所示, 使用了15个含量信息的特征集的参数反演神经网络B在原始测试集得到了很好的效果, 甚至要优于使用了58个含量信息的特征集的参数反演神经网络A的表现. 
在扩充测试集上, 由于特征集承载信息量不高, 参数反演神经网络B的表现不如参数反演神经网络A在扩充测试集上的表现, 同时相较于在原始测试集上的表现也有明显下滑, 但$R^2$仍然处在$94\%$附近, $MRE_{\vec{\alpha}}$也有
$3.50\%$. 
另外, 参数反演神经网络B在两个测试集上的$MRE_{C}$明显要更小, 原因是由于采样时间点都在$30h$之前, 化学品含量数值的数量级并不十分小, 相对误差的计算未受很大影响.
总的来说, 参数反演神经网络B在两个测试集上的效果都不错, 在原始测试集上的效果与参数反演神经网络A几乎持平, 在参数分布较极端的扩充测试集上的效果比参数反演神经网络A稍差.
图\ref{反演B}展示了$\vec{\alpha}=16.91,10.14,7.95$时参数反演神经网络B的效果, 其中的曲线为特征集化学品含量信息对应的未采样前的完整曲线, 散点为网络输出的化学品含量信息.
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode6_3.pgf}}
    \caption{$A_{plasma}(t)$}
    \label{反演B1}
  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \resizebox{1\textwidth}{!}{\input{./figs/pcode6_4.pgf}}
    \caption{$A_{urinebps}(t)$与$A_{urinebpsg}(t)$}
    \label{反演B2}
  \end{subfigure}
  \caption{$\vec{\alpha}=(16.91,10.14,7.95)$时参数反演神经网络B的输出可视化}
  \label{反演B}
\end{figure}

\subsection*{总结}
根据在测试集上的评价指标可认为, 两个使用了不同形状的特征集进行训练的参数反演神经网络都胜任了拟合PBPK模型求解模型中的函数$f$(见公式(\ref{eq2.1}))的反函数这一任务.
同时通过数值实验测试也验证了: 减少时间采样点的数量也能得到有效的参数反演结果. 这一结果可在深度学习数值测试意义上给药代动力学的实验提供了一种可能的理论基础: 在对模型进行参数校准时,
减少或精简对受试者采血或采尿的频次也可以得到与较多采样频次的情况相差并不大的参数校准结果, 以此来控制实验成本, 优化成本效益比, 获得更高的实验性价比.


\chapter{PBPK模型参数反演的神经网络方法: 使用随机时间节点数据}

本章聚焦于利用Hu等人\cite{11}提供的人体实验真实数据进行皮肤三参数组的参数校准, 在第三章的基础之上在数据集中加入时间信息, 利用对偶学习的方法, 使用PBPK模型正向生成的带有时间信息的数据分别训练了拟
合PBPK模型正向求解模型的神经网络以及PBPK模型参数反演的神经网络. 本章的神经网络模型可以接受任意时间节点处的化学品含量信息. 

本章首先在4.1节介绍了参数校准与本章神经网络基本特性的联系, 在4.2节介绍了网络模型训练所需的数据集的结构与构建, 接下来在4.3节讲述了本章神经网络模型的架构与训练, 
在4.4节介绍了对偶学习在本文的具体应用, 在3.5节展示了本章网络模型在测试集上的效果, 最后在4.6节利用
真实数据使用本章训练好的神经网络来进行PBPK模型的参数校准.

\section{参数校准与网络模型的基本介绍}
\ref{4.1}
Hu等人\cite{11}的研究提供的人体实验真实数据与本文的参数反演神经网络模型基础架构适配的部分为某位受试者在$0\sim 75h$内在$14$个时间节点处的尿液内累计的BPS与BPS-g含量之和(尿液累计含量的具体定义详情见\ref{3.1}节).
这些数据对应了14组的$(\textit{排尿时间}t_i, \textit{尿液累计化学品含量}A_i)$. 
在本章内, 欲将这些数据作为某种参数反演神经网络的输入, 输出反演得到的皮肤三参数组, 以一种新方法完成Hu等人\cite{11}研究中带平行分层皮肤仓室的PBPK模型的参数校准工作.

若利用第三章的使用固定时间信息的参数反演神经网络架构来做参数校准, 需要将真实数据中的14个排尿时间作为固定的时间采样节点, 建立单条含有14个化学品含量信息的特征集, 并训练神经网络模型. 
但这种处理方式在时间节点的处理上缺乏灵活性, 且真实的采样往往无法严格按照固定时间节点来执行. 故本章在神经网络模型的数据集中引入时间信息, 使得参数反演神经网络的输入中可加入时间点信息, 这意味着不再需要
固定的时间节点, 在进行参数校准时可以同时输入真实数据中的排尿时间. 为了使用真实数据内的全部14组数据, 设置参数反演神经网络模型的输入为$(A(t_1),\dots,A(t_{14}),t_1,\dots,t_{14})$, 其中后14个元素为
$0\sim 75h$内的14个时间点信息, 前14个元素为尿液中BPS与BPS-g累计含量之和曲线(简称为\textit{尿液BPS类含量曲线})在这14个时间点上的采样. 网络模型的输出依旧是反演得到的皮肤三参数组
$\vec{\alpha} = (\alpha_1,\alpha_2,\alpha_3)$. 
根据以上信息, 可知使用时间信息数据的参数反演神经网络是在拟合如下的函数:
\begin{equation}
  \label{eq3.2}
  h:(\mathbb{R}^{14})^{+}\times (0,75)^{14} \to \mathbb{R}^{3},\quad (A_1,\dots,A_{14},t_1,\dots,t_{14})\mapsto (\alpha_1,\alpha_2,\alpha_3).
\end{equation}


由于使用对偶学习的手段, 需要训练一个使用时间信息数据的PBPK模型的求解模型的正向拟合神经网络, 这个神经网络是在拟合如下的与PBPK模型求解有关的函数:
\begin{equation}
\label{eq3.1}
g:(\mathbb{R}^3)^{+}\times (0,75) \to \mathbb{R}^{+},\quad (\alpha_1,\alpha_2,\alpha_3, t)\mapsto A_{BPS}.
\end{equation}
即对这个神经网络输入一个皮肤三参数组与一个时间点信息, 可得到拟合的尿液BPS类含量曲线在该时间点的数值. 


\section{参数反演神经网络模型的数据集结构与构建}
\label{4.2}
本章参数反演神经网络使用的整个数据集由大量数据组成, 设置数据条数为$N$, 根据\label{4.1}节的介绍, 整个特征集是一个形状为$N \times 28$的二维数组,  与之对应的标签集是一个形状为$N \times 3$的二维数组. 
其中特征集由14个时间节点信息与14个对应时间点处的尿液BPS类含量曲线上的采样点构成, 称后者为\textit{尿液BPS类含量信息}. 

本章参数反演神经网络使用的标签集构造与\label{3.2.1}小节中的标签集完全相同, 其中互不相同的
皮肤三参数组共47743组. 
由于要加入时间信息, 一条标签内的皮肤三参数组对应的特征是14个时间点信息与尿液BPS类含量曲线上的采样点.  为了使神经网络模型充分训练, 捕捉到时间信息在需要拟合的函数$g$中的作用, 
需要尽可能使同一皮肤三参数组对应足够多的时间点信息, 故使一种皮肤三参数组对应20组14个点的时间信息, 意为皮肤三参数组代入至PBPK模型计算得到的尿液BPS类含量曲线共需采样20轮, 每轮共采样14个点并记录采样时间点信息, 其中
每轮内的采样时间点并不相同且每轮采样得到的数据单独视为一个特征条目. 依然秉持标签集和特征集内条目一一对应的原则, 使标签集内的每一个条目都复制至20条, 故本章中参数反演神经网络模型使用的标签集一共$47743\times 20 = 954860$条, 
标签集形状为$954860\times 3$.

对于标签集内47743组互不相同的皮肤三参数组内的每一组, 将其代入至PBPK模型的求解模型, 得到尿液BPS类含量曲线. 每条含量曲线需要采样20轮, 且每轮的采样时间点并不相同.
为了使采样时间点能契合真实数据的同时具有一定的随机性与普适性, 采用在$0\sim 75h$内随机抽取采样时间点的方法, 且将$0\sim 75h$划分为了许多小的抽取时间范围, 每个范围对应着固定的抽取个数, 以此来适配真实数据的时间点信息并
避免抽取出的时间点在$0\sim 75h$内分布失衡的情况. 单轮的抽取规则如表\ref{tab5}所示, 共抽取14个时间点.

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{c*{1}{c}}
    \hline
    \textit{抽取时间段} & \textit{抽取个数}\\
    \hline
    $0\sim 6h$&  2 \\ 
    $6\sim 12h$&  2 \\ 
    $12\sim 18h$&  2 \\ 
    $18\sim 30h$&  3 \\ 
    $30\sim 46h$&  2 \\ 
    $46\sim 54h$&  1 \\ 
    $54\sim 64h$&  1 \\ 
    $64\sim 75h$&  1 \\ 
    \hline
  \end{tabular}
  \caption{\label{tab5}$0\sim75h$上的采样时间点抽取规则(共14点)} 
\end{table}  

每条尿液BPS类含量曲线的20轮内采样时间点都是完全不同的, 每条曲线需要抽取20轮采样时间点, 共$47743\times 20 = 954860$轮, 每一轮抽取都是互相独立的, 结果互不影响.
得到时间点信息后, 对尿液BPS类含量曲线采样, 得到的尿液BPS类含量信息与时间点信息为特征集的一个条目, 共954860条, 特征集的形状为$954860\times 28$. 
图\ref{14采样点}展示了两个不同的尿液BPS类含量曲线与其随机抽取的14个采样点.
\begin{figure}[H]
  \centering
  \begin{subfigure}{0.45\textwidth}
    \centering
    \includegraphics[scale=0.5]{./figs/p6_1.png}
    \caption{$\vec{\alpha}=(10 , 6.91,  5.18)$}

  \end{subfigure}
  \begin{subfigure}{0.45\textwidth}
    \centering
    \includegraphics[scale=0.5]{./figs/p6_2.png}
    \caption{$\vec{\alpha}=(25.639  ,6.84, 2.79)$}
    
  \end{subfigure}
  \caption{两种尿液BPS类含量曲线与其随机采样点的示例}
  \label{14采样点}
\end{figure}

\section{参数反演神经网络模型的网络结构与训练}
本章的参数反演神经网络依旧使用了由全连接网络和残差网络模块构成的网络架构, 如图\ref{网络结构}. 另外本章的神经网络模型需要额外处理时间信息, 故增加
隐藏层神经元的数量与残差网络模块的数量, 以加深网络, 进一步提高网络提取特征信息的能力.
架构中的参数相应地设置为:
$$
inputsize = 28,\quad outputsize = 3,\quad hiddensize = 50, \quad hidden\_nums = 5.
$$
\noindent 网络的输入为含有14个时间点信息与对应的尿液BPS类含量信息, 每条输入共28个元素, 网络的输出为反演得到的皮肤三参数组, 每台输出共3个元素, 
中间隐藏层的神经元数量为50个, 残差网络模块的串联数量为5个.

本章的参数反演神经网络除损失函数外的训练流程与训练参数与\ref{3.4}节中网络模型的训练相同, 此处重点讲解损失函数的选取.
损失函数的设置利用了对偶学习的方法, 单条数据对应的损失函数具体为$\|\vec{\alpha}-\vec{\alpha^*} \|^2$与
$\sum_{i = 1}^{14}  [g(\vec{\alpha}, t_i)-\tilde{g}(\vec{\alpha^*}, t_i) ]^2$
的线性组合.
其中
$\vec{\alpha}$为标签皮肤三参数组, $\vec{\alpha^*}$为网络模型输出的反演得到的皮肤三参数组,$g$为公式(\ref{eq3.1})中的与PBPK模型的正向求解有关的函数, 
$\tilde{g}$为拟合了$g$的神经网络模型, 该网络模型的输入为一组皮肤三参数组与一个时间点信息, 输出为拟合的尿液BPS类含量曲线在该点的数值. 在下一节会详细介绍该正向拟合神经网络模型的内容.


\section{可输入时间信息的PBPK模型拟合神经网络模型}

作为参数反演神经网络训练所使用的损失函数的一部分, 本节中的神经网络模型拟合的是PBPK模型的正向求解模型内的一个部分所对应的函数$g$(见公式\ref{eq3.1}).
给定一组皮肤三参数组$\vec{\alpha}$与$0 \sim 75h$内的任意一个时间点$t_0$作为输入, 函数$g$可给出$\vec{\alpha}$所对应的尿液内BPS类含量曲线在$t_0$处的取值.

\subsection*{正向拟合神经网络模型的数据集结构与构建}

本节内正向拟合神经网络模型的输入为一个皮肤三参数组与一个时间点信息, 故特征集的形状为$N\times 4$, 其中$N$为数据集的条目数.
本小节的特征集基于\ref{3.5.2}小节中正向拟合神经网络模型的特征集建立, 其中互不相同的皮肤三参数组共 47743 组.
为了使正向拟合神经网络模型充分学习到不同时间点信息的特征, 设定一条皮肤三参数组需要与20个不同的时间点信息组成20条含有四个元素的特征, 其中的20个时间点在$0\sim 75h$内随机抽取. 类似于\ref{4.2}节中抽取时间点的方法, 将$0\sim 75h$分成许多时段, 并设置每个时段所需抽取的时间点数量, 这样的做法可以使时间点的分布尽量均匀, 以使特征集中含有充分的时间信息. 抽取时间点的规则如表\ref{tab6}所示, 共抽取20个时间点.
\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{cc|cc}
    \hline
    \textit{抽取时间段} & \textit{抽取个数} &\textit{抽取时间段} & \textit{抽取个数}\\
    \hline
    $0\sim 1h$&  1 &$12\sim 16.5h$&  1 \\ 
    $1\sim 2h$&  1 &$16.5\sim 21h$&  1 \\ 
    $2\sim 3h$&  1 &$21\sim 25.5h$&  1 \\ 
    $3\sim 4h$&  1 & $25.5\sim 30h$&  1 \\  
    $4\sim 5h$&  1 &$30\sim 37.5h$&  1 \\ 
    $5\sim 6h$&  1 &$37.5\sim 45h$&  1 \\  
    $6\sim 7h$&  1 &$45\sim 52.5h$&  1 \\ 
    $7\sim 8h$&  1 &$52.5\sim 60h$&  1 \\ 
    $8\sim 10h$&  1 &$60\sim 67.5h$&  1 \\ 
    $10\sim 12h$&  1 &$67.5\sim 75h$&  1 \\
    \hline
  \end{tabular}
  \caption{\label{tab6}$0\sim75h$上的采样时间点抽取规则(共20点)} 
\end{table}  

47743个不同的皮肤三参数组, 每组都对应二十次时间点抽取, 共$47743\times 20= 954860$次抽取, 所有抽取之间互相独立互不影响.
最后得到的特征集形状为$954860\times 4$. 标签集的构造较为简单, 每一条标签只由一个元素构成, 即是对应特征条目内的皮肤三参数组所对应的尿液BPS类含量曲线在特征条目内时间点上的采样值, 标签集的形状为$954860\times 1$.

\subsection*{正向拟合神经网络模型的网络结构与训练}

本节中的正向拟合神经网络模型的架构和图\ref{网络结构}中相同, 其隐藏层神经元数量为50个, 串联残差网络模块有5个, 输入数据有4个元素, 输出元素有1个元素,
架构中的参数相应地设置为:
$$
inputsize = 4,\quad outputsize = 1,\quad hiddensize = 50, \quad hidden\_nums = 5.
$$
本节的正向拟合神经网络除损失函数外的训练流程与训练参数与\ref{3.4}节中网络模型的训练相同, 单条数据的损失函数为标签数据与输出数据之间的平方误差.

\subsection*{正向拟合神经网络模型的效果展示}
本小节将展示正向拟合神经网络模型在测试集上的泛化效果, 评价指标为标签与输出之间的决定系数$R^2$ $\,$($R^2 \in (0,1]$, 决定系数越靠近1, 说明模型的拟合效果越好).
本节的正向拟合神经网络在测试集上得到的决定系数$R^2 = 99.99\%$, 说明拟合效果很好. 图\ref{正向效果2}展示了本节正向拟合神经网络的拟合效果, 曲线部分为数据集之外某皮肤
三参数组代入至PBPK模型求解得到的尿液中 BPS 和BPS-g的含量曲线, 散点部分为正向拟合神经网络输出的在随机抽取的20个时间点处的BPS含量信息. 通过可视化可发现正向拟合神经网络对 PBPK 正向模型的拟合效果较好.
\begin{figure}[H]
  \centering
  \includegraphics[scale=0.5]{./figs/p10.png}
  \caption{$\vec{\alpha}=(13.94 ,  4.99,  4.3)$时正向拟合神经网络的输出可视化}
  \label{正向效果2}
\end{figure}

\section{参数反演神经网络模型的效果展示}

与\ref{3.6}节相同, 本节将在数据集划分出的原始测试集与后续添加的扩充测试集上测试本章参数反演神经网络模型的效果.

\subsection*{评价指标说明}

本章仍然使用$MSE_{\vec{\alpha}}$, $MRE_{\vec{\alpha}}$, $MSE_{C}$, $MRE_{C}$, $R^2$五种评价指标. 其中$MSE_{\vec{\alpha}}$与$MRE_{\vec{\alpha}}$分别为标签皮肤三参数组与网络输出的反演后的皮肤三参数组之间的均方误差与平均相对误差; 
$MSE_{C}$, $MRE_{C}$和$R^2$分别为特征集中前14个元素对应的尿液BPS类含量信息与网络输出的皮肤三参数组对应的相应时间点的尿液BPS类含量信息之间的均方误差, 平均相对误差与决定系数.

\subsection*{扩充测试集}

扩充测试集内的皮肤三参数组在参数空间内的分布相较于原始测试集的标签集更加极端, 本章中扩充测试集的标签集的构建方法与\ref{3.6}节
中的完全相同, 都使用了截断正态分布采样的方法 , 共得到1000条标签数据. 
每条标签所对应的特征由两部分构成, 一部分是14个时间点信息, 另一部分是标签所对应的尿液BPS类含量曲线在这14个时间点上的采样值.
14个时间点需要从$0\sim75h$内随机抽取, 抽取规则与表\ref{tab5}相同. 与原始数据集的构造不同, 扩充测试集中的每条标签只对应了一轮时间点的抽取. 故扩充测试集的特征有形状$1000\times 28$.

\subsection*{参数反演神经网络的效果}

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{l*{5}{c}}
    \hline
    \textit{测试集类型} &$MSE_{\vec{\alpha}}$&$MRE_{\vec{\alpha}}$ & $MSE_{C}$& $MRE_{C}$& $R^2$\\
    \hline
    \textit{原始测试集} &  0.21  &   0.57\%     &   $1.16\times 10^{-5}$     &  1.07\%     &  99.75\%  \\ 
    \textit{扩充测试集} &  0.90  &   1.71\%     &   $1.85\times 10^{-4}$     &  2.11\%     & 96.99\%  \\ 
    \hline
  \end{tabular}
  \caption{\label{tab7}使用时间信息的参数反演神经网络在测试集上的评价指标} 
\end{table}  

如表\ref{tab7}, 使用时间信息的参数反演神经网络模型在两个测试集上都得到了很好的效果, 无论是皮肤三参数组还是含量信息的平均相对误差, 都控制在了2.2\%以内, 决定系数$R^2$也都在96\%以上. 相对来说, 本章的参数反演神经网络比第三章不使用时间信息的参数反演神经网络的泛化效果更好, 我认为这可能与数据集的大小有关, 上一章的数据集条目数为47743, 而本章的数据集条目数为954860, 足足是前者的20倍. 且本章的网络模型使用了更深的神经网络架构, 这可能也是泛化能力更强的原因之一.
图\ref{时间网络反演}展示了测试集内标签为$\vec{\alpha}=(19.75,8.89,3.73125)$的测试数据在本章参数反演神经网络中的输出
含量信息与特征集含量曲线.
\begin{figure}[H]
  \centering
  \includegraphics[scale=0.5]{./figs/p7.png}
  \caption{$\vec{\alpha}=(19.75,8.89,3.73)$时参数反演神经网络的输出可视化}
  \label{时间网络反演}
\end{figure}

\section{基于真实实验数据\cite{11}的参数校准}

将人体实验的真实数据, 14个时间点信息与14个尿液BPS类含量信息, 输入至本章的参数反演神经网络中, 网络输出反演后的皮肤三参数组$\vec{\alpha}=(14.9377,  6.1184,  3.7767)$, 作为校准后的皮肤三参数组.
将网络输出的皮肤三参数组代入至PBPK求解模型中, 得到一条尿液内BPS类含量曲线, 与前人校准得到的皮肤三参数组$\vec{\alpha}=(17.28,  6.39,  5,7)$对应的尿液内BPS类含量曲线和真实BPS类含量数据绘制在一起, 如图\ref{校准}.
\begin{figure}[H]
  \centering
  \includegraphics[scale=0.5]{./figs/p8.png}
  \caption{皮肤三参数组校准结果展示}
  \label{校准}
\end{figure}
\noindent 计算校准后的皮肤三参数组对应的14个时间点处的尿液BPS类含量信息与真实尿液BPS类含量信息之间的均方误差与平均相对误差, 得到的结果与两种方式的校准时间如表\ref{tab8}所示.
可以看到本文的校准方式在速度和精度上都超过了前人的传统优化方法.
\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{c*{3}{c}}
    \hline
    \textit{校准手段} &$MSE$&$MRE$&\textit{校准时间}\\
    \hline
    \textit{参数反演神经网络} & $1.17\times 10^{-3}$  &   29.56\% &0.001$s$  \\ 
    \textit{前人研究} & $6.21\times 10^{-1}$  &  62.13\%    & >5$min$   \\ 
    \hline
  \end{tabular}
  \caption{\label{tab8}两种校准手段的指标展示} 
\end{table}  

\chapter{PBPK模型的统计学分析}

模型校准完毕后, 使用敏感性分析与不确定性分析两种手段对现有模型的稳定性进行测试. 通过对模型的稳定性进行分析, 可以进一步确定校准操作的有效性以及模型本身的有效性, 以指导后续的模型修改方向.
\section{敏感性分析}

敏感性分析(Sensitivity Analysis, SA)是一种用于评估模型输出关于模型输入的变化的敏感度的分析手段\cite{29}.
在Hu等人\cite{11}的研究中, 将模型输出设置为$A_{plasma}(t)$的曲线下面积$AUC$与最大值$C_{max}$. 将模型的某种输入参数提高至原来的1.1倍, 或减少至原来的0.9倍, 并观察模型输出的变化幅度, 
即可得到模型输出关于该种参数的敏感度.

在本文中, PBPK模型只有皮肤三参数组$\vec{\alpha}=(\alpha_1,\alpha_2,\alpha_3)$作为输入, 即$DSC$, $Pfo$与$u_1$. 三个参数的基准值设置为上一章中使用参数反演神经网络得到的校准值
$\vec{\alpha}=(14.9377,  6.1184,  3.7767)$, 并对每个参数分别进行提高至1.1倍与减少至0.9倍的操作(即增减10\%), 记录$A_{plasma}(t)$的曲线下面积$AUC$与最大值$C_{max}$相应的变化幅度. 将皮肤三参数组的基准值
与更改值分别代入至PBPK模型的求解模型, 得到结果如表格\ref{tab9}所示. 可以看出, $AUC$对$DSC$变化的敏感性最高, 甚至百分比变化接近$50\%$, 其次是$u_1$, 对$Pfo$的敏感性很低. 另外, $AUC$与$u_1$的相关性和与$DSC$或$Pfo$的相关性相反.
校准后的$DSC$与$u_1$似乎能使$C_{max}$处在极小值附近, 因为无论增还是减$DSC$或$u_1$, $C_{max}$都会增加, 但增加的幅度不同. 相较于减小, 当$DSC$增加时, $C_{max}$增加的幅度更大, 对于$u_1$也是如此.
$C_{max}$可能与$Pfo$是线性的关系, $Pfo$增加10\%时, $C_{max}$也随之增加10\%, 当$Pfo$减少10\%时, $C_{max}$也随之减少10\%. 总的来说, 两个模型输出对皮肤三参数组的敏感性都较强, 说明了对皮肤三参数组进行校准的必要性.
同时, 对三个参数分别增减10\%, 模型的输出的百分比变化最高并未超过50 \%, 在某种程度上, 可说明此时的PBPK模型关于皮肤三参数组并不是病态的.

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{c*{2}{c}}
    \hline
    \textit{参数处理情况} &$C_{max}$\textit{百分比变化}  &$AUC$\textit{百分比变化}\\
    \hline
    $DSC\times1.1$ & $  20.76\%$ & $ 46.65 \%$  \\ 
    $DSC\times0.9$ & $  0.41\%$ &$  -35.79 \%$   \\ 
    $Pfo\times1.1$ & $  10.00\%$ &$   1.23 \%$   \\ 
    $Pfo\times0.9$ & $  -10.00\%$ &$    -1.23\%$  \\ 
    $u_1\times1.1$ & $  0.26\%$ &$   -26.99 \%$   \\ 
    $u_1\times0.9$ & $  3.54\%$ &$   37.26 \%$  \\ 
    \hline
  \end{tabular}
  \caption{\label{tab9}PBPK模型输出对皮肤三参数组的敏感度} 
\end{table}  

\section{不确定性分析}

不确定性分析是医学模型中常用的一个手段, 它的做法是利用蒙特卡洛模拟的方法依照某种概率分布抽取若干组模型的输入参数, 得到若干组模型输出, 之后将模型输出按从小到大的顺序排列, 并提取其中的
95分数(大于余下95\%的数据的值)与50分数(即中位数)\cite{30}. 模型的不确定值被定义为
$uncertainty = \frac{P95}{P50}$. 该值越接近于1, 说明模型输出对所选输入参数的不确定性越小, 该值大于2时, 说明模型的不确定性较高\cite{30}.

Hu等人\cite{11}在不确定性分析中使用了截断正态分布来依概率分布抽取模型的输入参数, 本节将对皮肤三参数组进行以概率分布的抽取, 并分别计算模型输出$A_{plasma}(t)$的曲线下面积$AUC$与最大值$C_{max}$对三个参数$DSC$, $Pfo$与$u_1$的不确定性.
其中皮肤三参数组的截断正态分布的平均值使用本文的校准结果, 变异系数统一设置为$30\%$, 标准差为平均值与变异系数的乘积, 左截断点为$lb = mean - 1.96\times std$, 右截断点为$lb = mean + 1.96\times std$,
三个参数的截断正态分布的参数如下所示:
\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{|l*{3}{l}|}

    $mean_1 = 14.9377$ &$std_1 = 4.48$ &$lb_1 = 6.16$ &$ub_1 =23.72$  \\ 
  
    $mean_2 = 6.1184$  &$std_2 = 1.84$ &$lb_2 = 2.512$ &$ ub_2 =9.7248$  \\ 
  
    $mean_3 = 3.7767$ &$std_3 = 1.13$  &$lb_3 = 1.56$ &$ub_3 =5.99$ \\ 
    
  \end{tabular}
\end{table}  

对每个参数分别以概率分布抽取10000次, 分别计算$AUC$与$C_{max}$关于三个参数的不确定性, 得到结果如表\ref{tab10}所示. 可以看到$C_{max}$关于$DSC$的不确定性最高, 超过了3.5, 关于$u_1$的不确定性也很高, 关于$Pfo$的不确定性较低, 小于1.5.  $AUC$关于$DSC$和$u_1$的不确定性都很高, 都超过了3.5, 关于$Pfo$的不确定性数值极低, 接近于1. 从不确定性分析可以看出, $DSC$与$u_1$相对来说对模型输出的贡献更大, 更值得关注.

\begin{table}[htbp]
  \centering
  \begin{tabular}[t]{c*{2}{c}}
    \hline
    \textit{参数} &$C_{max}$\textit{的不确定性}  &$AUC$\textit{的不确定性}\\
    \hline
    $DSC$ & $ 3.68$ & $3.81$  \\ 
    
    $Pfo$ & $  1.44$ &$  1.05$   \\ 
   
    $u_1$ & $  2.73$ &$  3.76$   \\ 
    
    \hline
  \end{tabular}
  \caption{\label{tab10}PBPK模型输出关于皮肤三参数组的不确定性} 
\end{table}  

\chapter{总结}

\section*{研究回顾}
本文基于Hu等人\cite{11}的研究, 从双酚S的人体平行分层皮肤的PBPK模型的模型求解, 模型参数校准到模型不确定性分析完成了对该模型的二次解读与构建.
其中文章的主题与着重点在于利用神经网络模型来进行模型的参数校准.
在模型求解部分, 本文总结了PBPK模型的数学形式并使用Python代码构建了模型的数值求解模型. 在参数校准部分, 本文分别构建了两类参数反演网络, 分别是不包含时间节点信息的网络模型包含时间节点信息的网络模型, 
网络的架构都是深度残差神经网络, 并使用对偶学习的方法完成了网络的训练. 利用包含时间节点信息的参数反演网络模型与Hu等人\cite{11}提供的人体实验数据完成了PBPK模型的参数校准. 最后, 利用校准好的参数完成了模型输出关于需校准的三个参数的敏感性分析与不确定性分析.

\section*{结论与讨论}
\subsection*{模型求解}
在模型求解部分, 本文利用Hu等人\cite{11}提供的PBPK模型的数学形式完成了求解代码的复现, 得到了与前人模型求解代码结果相同但速度超出其100倍的复现结果. 但
Hu等人提供的模型在当某些皮肤三参数组作为模型输入的情况下, 会求解得到出现双峰图案的血药含量曲线, 这代表着BPS在血液内的含量快速下降后又出现了明显回升, 在大多数情况下, 双峰的图案是不正确的,
也许是Hu等人提供的与皮肤相关的人体参数并不准确, 或者是带平行分层皮肤仓室的PBPK模型本身并不完善. 

\subsection*{参数校准与神经网络模型}

为了更加快速且精准地得到参数反演的结果, 本文建立了神经网络模型, 输入离散的血液中或尿液中BPS的含量信息, 网络模型会输出反演后的皮肤三参数组.
本质上, 参数反演神经网络是对PBPK模型的正向求解模型的反模型的拟合. 在原始测试集和扩充测试集上, 根据评价指标的数值可得出结论:本文提出的神经网络模型显示出了很好的泛化能力.
另外, 在使用固定时间点的神经网络模型背景下, 本文在数值实验的意义上得到减少采样时间点也能得到良好反演效果的结论, 意味着在真实人体实验中, 可以减少对受试者的采血采尿的频次, 以降低实验成本, 优化成本效益比.
最后, 本文利用真实数据完成了参数校准, 校准后的参数与Hu等人\cite{11}的校准参数相比, 在真实数据拟合方面有着更优秀的表现, 且本文的参数校准方法速度更快.

\subsection*{统计学分析}
本文的最后一部分基于校准后的参数, 对模型的两种输出(血药含量曲线的曲线下面积与最大值)进行了关于皮肤三参数组的敏感性分析和不确定性分析. 分析结果表明, $DSC$与$u_1$是对模型输出贡献较大的两个参数, 模型输出对这两个参数的不确定性和敏感性都很高, 这意味着这两个参数需要得到更进一步的模型解释与范围界定, 也可能意味着Hu等人\cite{11}提出的平行分层皮肤仓室模型的预测结果并不稳定, 存在较大风险, 需要改变模型结构或给出更合理的皮肤相关参数的取值.

\subsection*{结论}
神经网络模型在PBPK模型框架下能够胜任参数反演或参数校准的任务. 若研究者做人体实验的目的为校准模型参数, 在使用神经网络模型作为校准工具的前提下, 可以考虑减少对受试者采集生物材料的频次, 以降低成本节约时间.

\iffalse
\clearpage
\mbox{}
\thispagestyle{empty}
\fi

\appendix
% 附录部分

\iffalse
\chapter{代码}
\section{代码环境}
\begin{lstlisting}[language=PYTHON]

\end{lstlisting}
\fi


\chapter{PBPK模型物理量名称-含义对照表}
\CTEXsetup[format={\Large\bfseries}]{section}
\section*{模型中待求解变量}
\label{app:B}
\noindent$C_{SCi}(t)$  {\hfill 暴露皮肤组织的深度为$i\times \frac{T_{SC}}{10}$的角质层在$t$时刻的BPS浓度$(nmol/cm^3)$}\\
$A_{Fo}(t)$ {\hfill  暴露皮肤组织的毛囊在$t$时刻的BPS含量$(nmol)$}\\
$A_{well}(t)${\hfill 暴露皮肤组织的表皮储仓在$t$时刻的BPS含量$(nmol)$}\\
$A_{VE}(t)${\hfill 暴露皮肤组织的活性表皮在$t$时刻的BPS含量$(nmol)$}\\
$A_{ST}(t)${\hfill 胃部在$t$时刻的BPS含量$(nmol)$}\\
$A_{skin}(t)${\hfill 未暴露皮肤组织在$t$时刻的BPS含量$(nmol)$}\\
$A_{fat}(t)${\hfill 脂肪组织在$t$时刻的BPS含量$(nmol)$}\\
$A_{gonad}(t)${\hfill 性腺在$t$时刻的BPS含量$(nmol)$}\\
$A_{plasma}(t)${\hfill 血浆在$t$时刻的BPS含量$(nmol)$}\\
$A_{brain}(t)${\hfill 脑部在$t$时刻的BPS含量$(nmol)$}\\
$A_{rich}(t)${\hfill 血流丰富组织在$t$时刻的BPS含量$(nmol)$}\\
$A_{slow}(t)${\hfill 血流缓慢组织在$t$时刻的BPS含量$(nmol)$}\\
$A_{GIBPSg}(t)${\hfill 胃肠部在$t$时刻的BPS-g含量$(nmol)$}\\
$A_{GIBPSs}(t)${\hfill 胃肠部在$t$时刻的BPS-s含量$(nmol)$}\\
$A_{SI}(t)${\hfill 小肠在$t$时刻的BPS含量$(nmol)$}\\
$A_{liver}(t)${\hfill 肝脏在$t$时刻的BPS含量$(nmol)$}\\
$A_{BPSg\_delay}(t)${\hfill 发生了肝肠循环的BPS-g的量/小肠在$t$时刻的BPS-g含量$(nmol)$}\\
$A_{BPSs\_delay}(t)${\hfill 发生了肝肠循环的BPS-s的量/小肠在$t$时刻的BPS-s含量$(nmol)$}\\
$A_{BPSg}(t)${\hfill 整个机体在$t$时刻的BPS-g含量$(nmol)$}\\
$A_{BPSs}(t)${\hfill 整个机体在$t$时刻的BPS-s含量$(nmol)$}\\
$A_{urinebps}(t)${\hfill 人体排出的尿液在$t$时刻累计的BPS含量$(nmol)$}\\
$A_{urinebpsg}(t)${\hfill  人体排出的尿液在$t$时刻累计的BPS-g含量$(nmol)$}
\section*{其他变量}
\noindent$\varphi(x,t)${\hfill   暴露皮肤组织的角质层深度x处在$t$时刻的BPS浓度$(nmol/cm^3)$,}\\
$f_1(t)$ {\hfill  皮肤接触外源BPS的量$(nmol)$, 当$t> Time_{add}$时, $f_1(t)=0$}\\
$ON(t)$ {\hfill  布尔值, 当$t\leq Time_{expose}$时, $ON(t)=1$, 皮肤处于BPS暴露状态;}

\hfill 当$t> Time_{expose}$时, $ON(t)=0$, 皮肤处于未暴露状态\\
$f_2(t)$ {\hfill  口服外源BPS的量$(nmol)$, 本文中不考虑口服情况, $f_2(t)=0$}\\

\section*{待反演的参数}
\noindent$DSC$ {\hfill  角质层中的有效扩散系数$(cm^2/h)$}\\
$u_1$ {\hfill  由脱屑而向皮肤表面转移的速度$(cm/min)$}\\
$Pfo$ {\hfill  毛囊的渗透系数$(cm/h)$}

\section*{理化数据中的常量}
\noindent$T_{SC}$ {\hfill  角质层的深度$(um)$}\\
$SCDX$ {\hfill  角质层的深度的$\frac{1}{10}(um)$}\\
$HSC_{well}$ {\hfill  角质层和皮肤表皮储仓之间的分配系数}\\
$V_{well}$ {\hfill  暴露皮肤组织的表面储仓体积$(L)$}\\
$HSC_{VE}$ {\hfill  角质层和活性表皮之间的分配系数}\\
$V_{TVE}$ {\hfill  暴露皮肤组织的活性表皮层体积$(L)$}\\
$AEXP $ {\hfill  暴露皮肤组织面积$ (dm^2)$}\\
$ FEXP$ {\hfill  暴露皮肤组织中毛囊的面积分数}\\
$HFo_{well}$ {\hfill  毛囊和皮肤表皮储仓之间的分配系数}\\
$V_{TFo}$ {\hfill  暴露皮肤组织的毛囊体积$(L)$}\\
$ Qskin$ {\hfill  皮肤血液流速$(L/h) $}\\
$ pskin$ {\hfill  皮肤-血浆分配系数}\\
$ BSA$ {\hfill  人体皮肤表面积$(dm^2) $}\\
$V_{plasma}$ {\hfill  血浆体积$(L)$}\\
$k0 $ {\hfill  口服给药时BPS从胃进入肝脏的系数$(h^{-1})$}\\
$k1 $ {\hfill  口服给药时BPS从小肠进入肝脏的系数$(h^{-1})$}\\
$ ge$ {\hfill  口服给药时BPS由胃转移至小肠的系数$(h^{-1})$}\\
$V_{TSC}$ {\hfill  暴露皮肤组织的角质层体积$(L)$}\\
$V_{skin}$ {\hfill  皮肤组织的体积$(L)$}\\
$ Qfat$ {\hfill  脂肪组织血液流速$(L/h) $}\\
$V_{fat}$ {\hfill  脂肪组织的体积$(L)$}\\
$ pfat$ {\hfill  脂肪-血浆分配系数}\\
$ Qgonad$ {\hfill  性腺血液流速$(L/h) $}\\
$V_{gonad}$ {\hfill  性腺的体积$(L)$}\\
$ pgonad$ {\hfill  性腺-血浆分配系数}\\
$ Kurinebps $ {\hfill  BPS尿液排泄参数$(L/h)$}\\
$ Qc$ {\hfill  心脏血液流速$(L/h)$}\\
$ Qbrain$ {\hfill  脑部血液流速$(L/h) $}\\
$V_{brain}$ {\hfill  脑部的体积$(L)$}\\
$ pbrain$ {\hfill  脑部-血浆分配系数}\\
$ Qrich$ {\hfill  血流丰富组织血液流速$(L/h) $}\\
$V_{rich}$ {\hfill  血流丰富组织的体积$(L)$}\\
$ prich$ {\hfill  血流丰富组织-血浆分配系数}\\
$ Qslow$ {\hfill  血流缓慢组织血液流速$(L/h) $}\\
$V_{slow}$ {\hfill  血流缓慢组织的体积$(L)$}\\
$ pslow$ {\hfill  血流缓慢组织-血浆分配系数}\\
$ Qliver$ {\hfill  肝脏血液流速$(L/h) $}\\
$V_{liver}$ {\hfill  肝脏的体积$(L)$}\\
$ pliver$ {\hfill  肝脏-血浆分配系数}\\
$kGIing$ {\hfill 口服给药BPS-g从肠到血中的系数 $(h^{-1})$}\\
$kGIins $ {\hfill  口服给药BPS-s从肠到血中的系数 $(h^{-1})$}\\
$Vmaxgutg$ {\hfill  肠道中BPS葡萄苷酸化的最大反应速度$(nmol/h)$}\\
$Vmaxguts$ {\hfill  肠道中BPS硫酸盐化的最大反应速度$(nmol/h)$}\\
$enterocytes $ {\hfill  小肠体积$(L)$}\\
$ Kmgutg$ {\hfill  肠道中BPS葡萄苷酸化的米氏常数$(nmol)$}\\
$ Kmguts$ {\hfill  肠道中BPS硫酸盐化的米氏常数$(nmol)$}\\
$ Ksigutg$ {\hfill  肠道中葡萄苷酸化结合底物抑制常数$(nmol)$}\\
$ kenterobpsg$ {\hfill  BPS-g肝肠循环使得BPS发生循环的速率$(h^{-1})$}\\
$ kenterobpss$ {\hfill  BPS-s肝肠循环使得BPS发生循环的速率$(h^{-1})$}\\
$ Kmliverg$ {\hfill  肝脏中BPS葡萄苷酸化的米氏常数$(nmol)$}\\
$Vmaxliverg$ {\hfill  肠道中BPS葡萄苷酸化的最大反应速度$(nmol/h)$}\\
$ Kmlivers$ {\hfill  肝脏中BPS硫酸盐化的米氏常数$(nmol)$}\\
$Vmaxlivers$ {\hfill  肠道中BPS硫酸盐化的最大反应速度$(nmol/h)$}\\
$met1g $ {\hfill  肝脏中BPS-g进入血液中的比例}\\
$ met1s$ {\hfill  肝脏中BPS-s进入血液中的比例}\\
$met2g = 1 -  met1g$ {\hfill  肝脏中BPS-g进入肝肠循环的比例}\\
$ met2s= 1 -  met1s$ {\hfill  肝脏中BPS-s进入肝肠循环的比例}\\
$ kentero$ {\hfill  BPS-g肝肠循环的速率$(h^{-1})$}\\
$k4_{IV} $ {\hfill  BPS-g在肝肠循环中的粪便消除系数$(h^{-1})$}\\
$ Kurinebpsg$ {\hfill  BPS-g的尿液排泄参数$(L/h)$}\\
$Vbodyg  $ {\hfill  参与BPS-g分布的组织体积$(L)$}\\
$ Kurinebpss$ {\hfill  BPS-s的尿液排泄参数$(L/h)$}\\
$ Vbodys$ {\hfill  参与BPS-s分布的组织体积$(L)$}

\section*{实验设置的常量}
\noindent$Time_{add}=\frac{1}{6}h$ {\hfill  手指皮肤触摸热敏纸(外源BPS)的时间$(h)$}\\
$Time_{expose}=\frac{13}{6}h$ {\hfill  手指皮肤表皮储仓内BPS含量大于0的时间$(h)$}\\

\iffalse
\clearpage
\mbox{}
\thispagestyle{empty}
\fi

% 引用部分
\bibliography{REF}
% \bibliographystyle{authoryear}


% 引用过的文献会自动进入这一部分,如果有文献未引用但也想放入参考文献,请使用以下命令
% \nocite{请填入文献代码}
% 需要使用其它格式时请将该句取消注释.
\addcontentsline{toc}{chapter}{参考文献}
% 将参考文献加入目录

\iffalse
\clearpage
\mbox{}
\thispagestyle{empty}
\fi
\chapter*{致\quad 谢}
\addcontentsline{toc}{chapter}{致谢}
% 将致谢加入目录
\normalsize
四年的大学时光, 像童年回忆中某个闲暇午后湖面上的浮金, 美好且耀眼. 也许毕业论文是湖面上一只大雁, 人生的镜头在此刻对焦于它.
大雁在水光最迷人的一刻振翅起飞, 画幅跟随它离开了那片湖, 聚焦于下一个故事发生的舞台.

毕业论文的致谢中, 我最想感谢的是导师陈文斌老师. 陈老师在论文的选题, 研究与撰写期间都为我提供了许多宝贵且重要的真知灼见, 另外, 在论文的结构与格式修订上, 陈老师也耐心地给出了很多细致入微的建议.
能得到陈老师的指导, 我感觉到非常幸运. 感谢陈老师所付出的指导与帮助!祝愿老师事事顺意, 平安幸福.
其次, 我要感谢复旦大学公卫学院的章志淳学长对我的帮助. 我的论文基于医药学的研究背景, 章志淳学长无私且耐心的指点是我毕业论文研究的关键. 祝愿章志淳学长毕业后事业有成 .
另外, 感谢于泰来同学对我毕业论文的无私贡献, 祝愿于泰来同学在后续的学习生活中一帆风顺. 最后, 我想感谢大学四年中有幸相遇的每一位专业课老师, 知识的代代传授是人类智慧最浪漫的概念, 祝愿老师们工作顺利, 心情愉快. 

走过四年光阴, 闭上双眼, 在内心回响的始终是与亲人们的记忆. 我要感谢我的奶奶, 妈妈和爸爸. 在离开家乡的日子里, 是微信和电话里的亲情给了我永远走下去的动力. 养育之恩难以为报, 唯有在亲情中灌注更多呵护与关爱.
手机里天气软件内首页显示是自动定位的杨浦区, 第二页就是家乡, 我牵挂着距离我1600公里的家人处在怎样一片天空之下.
陪伴是最珍贵的财富, 我要感谢心儿和小果, 他们始终陪伴着我, 使我成为了更好的人. 在2023年数院夏令营的面试结束后, 我心如死灰, 一度认为自己已经``落榜'', 是心儿一直在安慰我鼓励我. 
小虫的《凉夜窗情》如泣如诉的旋律一响起, 有关那段等待放榜的炎热日子的记忆便历历在目, 是心儿陪着我度过了最难熬的时光. 谢谢你, 心儿,

使我成为了更好的自己, 心儿, 谢谢你

\end{document}

